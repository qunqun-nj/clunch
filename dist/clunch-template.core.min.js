/*!
 * clunch.js <core@template> - üé® The Progressive JavaScript Interactive Picture Framework.
 * git+https://github.com/hai2007/clunch.git
 *
 * author hai2007 < https://hai2007.gitee.io/sweethome >
 *
 * version 0.1.0-alpha.1
 *
 * Copyright (c) 2020 hai2007 Ëµ∞‰∏ÄÊ≠•ÔºåÂÜçËµ∞‰∏ÄÊ≠•„ÄÇ
 * Released under the MIT license
 *
 * Date:Thu Nov 26 2020 15:32:19 GMT+0800 (GMT+08:00)
 */
(function(){"use strict";function r(e){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){r=function(e){return typeof e}}else{r=function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return r(e)}function t(e){if(!(this instanceof t)){console.error("[Clunch error]: Clunch is a constructor and should be called with the `new` keyword");return}}t.prototype.__defineSerirs={};function n(e){var t=r(e);return e!=null&&(t==="object"||t==="function")}var o=Object.prototype.toString;function i(e){if(e==null){return e===undefined?"[object Undefined]":"[object Null]"}return o.call(e)}function e(e){var t=r(e);return t==="string"||t==="object"&&e!=null&&!Array.isArray(e)&&i(e)==="[object String]"}function a(e){if(!n(e)){return false}var t=i(e);return t==="[object Function]"||t==="[object AsyncFunction]"||t==="[object GeneratorFunction]"||t==="[object Proxy]"}var g=e;var x=a;var f=[];var l=13;var s=400;var d=null;function u(t,e,r){var u={timer:function e(t,r,n){if(!t){throw new Error("Tick is required!")}r=r||s;var o=(new Date).valueOf()+"_"+(Math.random()*1e3).toFixed(0);f.push({id:o,createTime:new Date,tick:t,duration:r,callback:n});u.start();return o},start:function e(){if(!d){d=setInterval(u.tick,l)}},tick:function e(){var t,r,e,n,o,i,a,l=f;f=[];f.length=0;for(r=0;r<l.length;r++){o=l[r];t=o.createTime;e=o.tick;i=o.duration;n=o.callback;a=(+new Date-t)/i;a=a>1?1:a;e(a);if(a<1&&o.id){f.push(o)}else if(n){n(a)}}if(f.length<=0){u.stop()}},stop:function e(){if(d){clearInterval(d);d=null}}};var n=u.timer(function(e){t(e)},e,r);return function(){var e;for(e in f){if(f[e].id==n){f[e].id=undefined;return}}}}var c=function e(t,r){for(var n in r){try{t[n]=r[n]}catch(e){throw new Error("Illegal property valueÔºÅ")}}return t};var p={whitespace:"[\\x20\\t\\r\\n\\f]"};function h(e,t){for(var r in t){try{e[r]=t[r]}catch(e){throw new Error("Illegal property valueÔºÅ")}}return e}function v(u){u=h({u:.5},u);var f,s,d;var c=function e(t){if(f){var r=(t-s)/(d-s),n=r*r,o=r*n;var i=o*f[0]+n*f[1]+r*f[2]+f[3];return i*(d-s)}else throw new Error("You shoud first set the position!")};c.setP=function(e,t,r,n,o,i){if(e<r){s=e;d=r;var a=u.u*o,l=u.u*i;t/=r-e;n/=r-e;f=[2*t-2*n+a+l,3*n-3*t-2*a-l,a,t]}else throw new Error("The point x-position should be increamented!");return c};return c}function m(o){o=c({t:0},o);var i,r;var a=function e(t){if(i){r=-1;while(r+1<i.x.length&&(t>i.x[r+1]||r==-1&&t>=i.x[r+1])){r+=1}if(r==-1||r>=i.h.length)throw new Error("Coordinate crossing!");return i.h[r](t)}else{throw new Error("You shoud first set the position!")}};a.setT=function(e){if(typeof e==="number"){o.t=e}else{throw new Error("Expecting a figure!")}return a};a.setP=function(e){i={x:[],h:[]};var t,r=(e[1][1]-e[0][1])/(e[1][0]-e[0][0]),n;i.x[0]=e[0][0];for(t=1;t<e.length;t++){if(e[t][0]<=e[t-1][0])throw new Error("The point position should be increamented!");i.x[t]=e[t][0];n=t<e.length-1?(e[t+1][1]-e[t-1][1])/(e[t+1][0]-e[t-1][0]):(e[t][1]-e[t-1][1])/(e[t][0]-e[t-1][0]);i.h[t-1]=v({u:(1-o.t)*.5}).setP(e[t-1][0],e[t-1][1],e[t][0],e[t][1],r,n);r=n}return a};return a}function y(e,t){var r=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e,null):e.currentStyle;return g(t)?r.getPropertyValue(t):r}var b=function e(t){var r=document.getElementsByTagName("head")[0];r.style["color"]=t;var n=y(r,"color");var o=n.replace(/^rgba?\(([^)]+)\)$/,"$1").split(new RegExp("\\,"+p.whitespace));return[+o[0],+o[1],+o[2],o[3]==undefined?1:+o[3]]};var w=function e(t,r){if(!(r&&r>=0&&r<=1))r=1;var n=[];for(var o=1;o<=t;o++){n.push("rgba("+(Math.random(1)*230+20).toFixed(0)+","+(Math.random(1)*230+20).toFixed(0)+","+(Math.random(1)*230+20).toFixed(0)+","+r+")")}return n};function N(e){var f=e||{},s,n;var o=function e(){var a=[],l=0,u=0;(function e(t,r){if(r>u)u=r;var n;for(n=0;n<t.children.length;n++){e(s[t.children[n]],r+1)}s[t.id].left=r+.5;if(n==0){if(a[r]==undefined)a[r]=-.5;if(a[r-1]==undefined)a[r-1]=-.5;s[t.id].top=a[r]+1;var o=a[r]+1+(s[t.pid].children.length-1)*.5;if(o-1<a[r-1])s[t.id].top=a[r-1]+1-(s[t.pid].children.length-1)*.5}else{s[t.id].top=(s[t.children[0]].top+s[t.children[n-1]].top)*.5}if(s[t.id].top<=a[r]){var i=a[r]+1-s[t.id].top;(function e(t,r){s[t].top+=i;if(a[r]<s[t].top)a[r]=s[t].top;var n;for(n=0;n<s[t].children.length;n++){e(s[t].children[n],r+1)}})(t.id,r)}a[r]=s[t.id].top;if(s[t.id].top+.5>l)l=s[t.id].top+.5})(s[n],0);return{node:s,root:n,size:l,deep:u+1}};var i=function e(i){var a={};var t=f.root(i),l,r;l=r=f.id(t);a[l]={data:t,pid:null,id:l,children:[]};var u=1;(function e(t,r){var n=f.child(t,i),o;u+=n?n.length:0;for(o=0;n&&o<n.length;o++){l=f.id(n[o]);a[r].children.push(l);a[l]={data:n[o],pid:r,id:l,children:[]};e(n[o],l)}})(t,l);return{value:[r,a],num:u}};var t=function e(t){var r=i(t);s=r.value[1];n=r.value[0];if(r.num==1){s[n].left=.5;s[n].top=.5;return{deep:1,node:s,root:n,size:1}}return o()};t.root=function(e){f.root=e;return t};t.child=function(e){f.child=e;return t};t.id=function(e){f.id=e;return t};return t}var _=function e(t,r,n,o,i){var a=Math.cos(n),l=Math.sin(n);return[+((o-t)*a-(i-r)*l+t).toFixed(7),+((o-t)*l+(i-r)*a+r).toFixed(7)]};var T=function e(t,r,n,o,i){var a=Math.sqrt(t*t+r*r);return[+(t*n/a+o).toFixed(7),+(r*n/a+i).toFixed(7)]};var $=function e(t,r,n,o,i){return[+(n*(o-t)+t).toFixed(7),+(n*(i-r)+r).toFixed(7)]};var k=function e(i){i=c({d:[1,1],c:[0,0],p:[0,0]},i);var a={rotate:function e(t){var r=i.d[0]+i.p[0],n=i.d[1]+i.p[1];var o=_(i.p[0],i.p[1],t,r,n);i.d=[o[0]-i.p[0],o[1]-i.p[1]];return a},move:function e(t){i.p=T(i.d[0],i.d[1],t,i.p[0],i.p[1]);return a},scale:function e(t){i.p=$(i.c[0],i.c[1],t,i.p[0],i.p[1]);return a},value:function e(){return i.p}};return a};function E(b){b=c({"begin-deg":0,deg:Math.PI*2},b);var w=N().root(b.root).child(b.child).id(b.id);var t=function e(t){var r=w(t);for(var n in r.node){r.node[n].deep=r.node[n].left-.5}if(b.type==="LR"||b.type==="RL"){var o=b.width/r.deep;if("RL"===b.type)o*=-1;var i=b.height/(r.size- -.5);for(var a in r.node){var l=r.node[a];r.node[a].left=+(("RL"==b.type?b.width:0)- -l.left*o).toFixed(7);r.node[a].top=+(l.top*i).toFixed(7)}}else if(b.type==="TB"||b.type==="BT"){var u=b.height/r.deep;if("BT"==b.type)u*=-1;var f=b.width/(r.size- -.5);var s,d;for(var c in r.node){var p=r.node[c];s=p.left;d=p.top;r.node[c].top=+(("BT"==b.type?b.height:0)- -s*u).toFixed(7);r.node[c].left=+(d*f).toFixed(7)}}else if(b.type==="circle"){if(r.deep==1&&r.size==1){r.node[r.root].left=b.cx;r.node[r.root].top=b.cy}else{var h=b.radius/(r.deep-1);var g=b.deg/(r.size- -.5);for(var v in r.node){var m=r.node[v];r.node[v].deg=(b["begin-deg"]- -g*m.top)%(Math.PI*2);var y=_(b.cx,b.cy,r.node[v].deg,b.cx- -h*(m.left-.5),b.cy);r.node[v].left=+y[0];r.node[v].top=+y[1]}}}if(x(b.drawer)){b.drawer(r);return e}else{return r}};t.config=function(e){b=c(b,e);return t};t.drawer=function(e){b.drawer=e;return t};return t}function F(o){var t=[];var e=function e(n){if(["boolean","number","json","string","color","any"].indexOf(o[n])>-1){t.unshift(function(t){var r=arguments.length>0?false:true;return function(e){return{type:o[n],required:r,animation:e,default:t}}})}else{t.unshift({$animation:u,$cardinal:m,$formatColor:b,$getRandomColors:w,$tree:E,$dot:k,$rotate:_,$move:T,$scale:$}[o[n]])}};for(var r=o.length-2;r>=0;r--){e(r)}return o[o.length-1].apply(this,t)}function C(e){var t=F(e);for(var r in t.attrs){if(x(t.attrs[r])){t.attrs[r]=t.attrs[r](false)}}for(var n in t.subAttrs){for(var o in t.subAttrs[n]){if(x(t.subAttrs[n][o])){t.subAttrs[n][o]=t.subAttrs[n][o](false)}}}return t}function R(n){n.series=function(e,t){if(arguments.length==1){for(var r in e){n.series(r,e[r])}}else{if(x(n.prototype.__defineSerirs[e])){console.warn("The series["+e+"] has been registered!")}n.prototype.__defineSerirs[e]=C(t)}return n}}R(t);t.prototype.$mount=function(e){};t.prototype.$unmount=function(){};t.prototype.$destroy=function(){};var S={blankReg:new RegExp("[\\x20\\t\\r\\n\\f]"),blanksReg:/^[\x20\t\r\n\f]{0,}$/,identifier:/^[a-zA-Z_$][0-9a-zA-Z_$]{0,}$/};function j(i){var a={},l=0;i=i.trim();var e=function e(){var t="",r="";for(;l<i.length;l++){if(S.blanksReg.test(i[l])||l==i.length-1){t+=i[l];if(!S.blanksReg.test(t)){a[t.trim()]=""}l+=1;break}else if(i[l]=="="){l+=1;var n=null,o=-1;if(i.substr(l,1)=='"'||i.substr(l,1)=="'"){n=i.substr(l,1);o=1;l+=1}else if(i.substr(l,2)=='"'||i.substr(l,2)=="'"){n=i.substr(l,2);o=2;l+=2}if(n!==null){for(;l<i.length;l++){if(i.substr(l,o)==n){a[t.trim()]=r.trim();l+=2;break}else{r+=i[l]}}}else{for(;l<i.length;l++){if(S.blanksReg.test(i[l])){a[t.trim()]=r.trim();l+=1;break}else{r+=i[l]}}}break}else{t+=i[l]}}if(l<i.length){e()}};e();return a}function P(f){var s=-1,d=null;var c=false,p="";var h=["script","pre","style","code"];var g=function e(){d=s++<f.length-1?f[s]:null;return d};var v=function e(t){return f.substring(s,t+s>f.length?f.length:t+s)};g();while(S.blankReg.test(d)&&s<f.length-1){g()}return function(){var e=d,t={};if(e==null)return null;if(c){t.type="textcode";t.tagName=e;while(v(p.length+3)!="</"+p+">"&&s<f.length){t.tagName+=g()}t.tagName=t.tagName.replace(/<$/,"");c=false;return t}if(v(4)=="\x3c!--"){t.type="comment";t.tagName=e;while(v(3)!="--\x3e"&&s<f.length){t.tagName+=g()}g();g();g();t.tagName=t.tagName.replace(/^<!--/,"").replace(/-$/,"");return t}if(v(9)=="<!DOCTYPE"){t.type="DOCTYPE";t.tagName=e;while(v(1)!=">"&&s<f.length){t.tagName+=g()}g();t.tagName=t.tagName.replace(/^<!DOCTYPE/,"").replace(/>$/,"");return t}else if(e=="<"){var r=false,n=null,o=null;while(r||d!=">"&&s<f.length){e+=g();if(r){var i=v(o+1).substring(1);if(i==n){r=false}}else{var a=v(2);if(a=='="'||a=="='"){n=a.replace("=","");o=1;r=true}a=v(3);if(a=='="'||a=="='"){n=a.replace("=","");o=2;r=true}}}if(/^<\//.test(e)){t.tagName=e.replace(/^<\//,"").replace(/>$/,"");t.type="endTag"}else{if(/\/>$/.test(e)){t.type="fullTag";e=e.replace(/\/>$/,"")}else{t.type="beginTag";e=e.replace(/>$/,"")}e=e.replace(/^</,"");t.tagName="";var l=0;for(;l<e.length;l++){if(e[l]==" ")break;t.tagName+=e[l]}var u=e.substring(l);if(S.blanksReg.test(u)){t.attrs={}}else{t.attrs=j(u)}}}else{t.type="textcode";t.tagName=d;while(v(1)!="<"&&s<f.length){t.tagName+=g()}t.tagName=t.tagName.replace(/<$/,"");s-=1}if(t.type=="beginTag"){if(h.indexOf(t.tagName.toLowerCase())>-1){c=true;p=t.tagName}}else if(t.type=="endTag"){if(h.indexOf(t.tagName.toLowerCase())>-1){c=false}}g();return t}}function A(e){e=M(e);var t=0,r=[];e.forEach(function(e){if(e.type=="beginTag"){r.push({type:"tag",name:e.tagName,attrs:e.attrs,__deep__:++t,__tagType__:"double"})}else if(e.type=="endTag"){t-=1}else if(e.type=="textcode"){r.push({type:"text",content:e.tagName,__deep__:t+1})}else if(e.type=="comment"){r.push({type:"comment",content:e.tagName,__deep__:t+1})}else{r.push({type:"tag",name:e.tagName,attrs:e.attrs,__deep__:t+1,__tagType__:"single"})}});return r}var M=function e(n){var o=[];n.forEach(function(e,t){if(e.type=="beginTag"){o.push([t,e.tagName])}else if(e.type=="endTag"){while(o.length>0){var r=o.pop();if(r[1]==e.tagName){break}else{n[r[0]].type="fullTag"}}}});return n};function O(e,t){if(!g(e))throw new Error("Template must be a String!");var r=P(e.trim());var n=r(),o=[];while(n!=null){if(n.type=="textcode"&&S.blanksReg.test(n.tagName));else if(n.type=="DOCTYPE");else if(n.type=="comment"){if(t){o.push(n)}}else{o.push(n)}n=r()}o=A(o);var i=[null],a=0;for(var l=0;l<o.length;l++){var u=l,f=o[l].__deep__;o[l].childNodes=[];o[l].preNode=null;o[l].nextNode=null;var s=i[i.length-1];var d=i.length>1?i[i.length-2]:null;if(f==a){o[u].preNode=s;o[s].nextNode=u;o[u].parentNode=d;o[d].childNodes.push(u);i[i.length-1]=u}else if(f>a){o[u].parentNode=s;if(s!=null)o[s].childNodes.push(u);i.push(u)}else{var c=i[i.length-1-(a-f)];var p=i[i.length-2-(a-f)];o[u].preNode=c;if(c!=null)o[c].nextNode=u;o[u].parentNode=p;if(p!=null)o[p].childNodes.push(u);for(var h=0;h<a-f;h++){i.pop()}i[i.length-1]=u}a=f}return o}function z(e){console.log(O(e))}t.prototype.$$templateCompiler=z;if((typeof module==="undefined"?"undefined":r(module))==="object"&&r(module.exports)==="object"){module.exports=t}else{window.Clunch=t}})();