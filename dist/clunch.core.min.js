/*!
 * clunch.js <core> - 🎨 The Progressive JavaScript Interactive Picture Framework.
 * git+https://github.com/hai2007/clunch.git
 *
 * author hai2007 < https://hai2007.gitee.io/sweethome >
 *
 * version 0.3.0
 *
 * Copyright (c) 2020 hai2007 走一步，再走一步。
 * Released under the MIT license
 *
 * Date:Wed Dec 30 2020 13:25:01 GMT+0800 (GMT+08:00)
 */
(function(){"use strict";function n(e){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){n=function(e){return typeof e}}else{n=function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return n(e)}function r(e){var t=n(e);return e!=null&&(t==="object"||t==="function")}var t=Object.prototype.toString;function i(e){if(e==null){return e===undefined?"[object Undefined]":"[object Null]"}return t.call(e)}function e(e){return typeof e==="number"||e!==null&&n(e)==="object"&&i(e)==="[object Number]"}function o(e){var t=n(e);return t==="string"||t==="object"&&e!=null&&!Array.isArray(e)&&i(e)==="[object String]"}function a(e){if(!r(e)){return false}var t=i(e);return t==="[object Function]"||t==="[object AsyncFunction]"||t==="[object GeneratorFunction]"||t==="[object Proxy]"}function s(e){if(e===null||n(e)!=="object"||i(e)!="[object Object]"){return false}if(Object.getPrototypeOf(e)===null){return true}var t=e;while(Object.getPrototypeOf(t)!==null){t=Object.getPrototypeOf(t)}return Object.getPrototypeOf(e)===t}var u=function e(t,r){return r!==null&&n(r)==="object"&&t.indexOf(r.nodeType)>-1&&!s(r)};var f=e;var x=o;var w=a;var $=function e(t){return Array.isArray(t)};var l=function e(t){return u([1,9,11],t)};var c=[];var h=13;var d=400;var p=null;function v(t,e,r){var u={timer:function e(t,r,n){if(!t){throw new Error("Tick is required!")}r=r||d;var i=(new Date).valueOf()+"_"+(Math.random()*1e3).toFixed(0);c.push({id:i,createTime:new Date,tick:t,duration:r,callback:n});u.start();return i},start:function e(){if(!p){p=setInterval(u.tick,h)}},tick:function e(){var t,r,e,n,i,o,a,s=c;c=[];c.length=0;for(r=0;r<s.length;r++){i=s[r];t=i.createTime;e=i.tick;o=i.duration;n=i.callback;a=(+new Date-t)/o;a=a>1?1:a;e(a);if(a<1&&i.id){c.push(i)}else if(n){n(a)}}if(c.length<=0){u.stop()}},stop:function e(){if(p){clearInterval(p);p=null}}};var n=u.timer(function(e){t(e)},e,r);return function(){var e;for(e in c){if(c[e].id==n){c[e].id=undefined;return}}}}var _=function e(t,r){for(var n in r){try{t[n]=r[n]}catch(e){throw new Error("Illegal property value！")}}return t};var g={whitespace:"[\\x20\\t\\r\\n\\f]"};var b=function e(t){if(/^[_$]/.test(t)){console.warn("The beginning of _ or $ is not allowed："+t)}};function m(e,t){for(var r in t){try{e[r]=t[r]}catch(e){throw new Error("Illegal property value！")}}return e}function y(u){u=m({u:.5},u);var f,l,c;var h=function e(t){if(f){var r=(t-l)/(c-l),n=r*r,i=r*n;var o=i*f[0]+n*f[1]+r*f[2]+f[3];return o*(c-l)}else throw new Error("You shoud first set the position!")};h.setP=function(e,t,r,n,i,o){if(e<r){l=e;c=r;var a=u.u*i,s=u.u*o;t/=r-e;n/=r-e;f=[2*t-2*n+a+s,3*n-3*t-2*a-s,a,t]}else throw new Error("The point x-position should be increamented!");return h};return h}function T(i){i=_({t:0},i);var o,r;var a=function e(t){if(o){r=-1;while(r+1<o.x.length&&(t>o.x[r+1]||r==-1&&t>=o.x[r+1])){r+=1}if(r==-1||r>=o.h.length)throw new Error("Coordinate crossing!");return o.h[r](t)}else{throw new Error("You shoud first set the position!")}};a.setT=function(e){if(typeof e==="number"){i.t=e}else{throw new Error("Expecting a figure!")}return a};a.setP=function(e){o={x:[],h:[]};var t,r=(e[1][1]-e[0][1])/(e[1][0]-e[0][0]),n;o.x[0]=e[0][0];for(t=1;t<e.length;t++){if(e[t][0]<=e[t-1][0])throw new Error("The point position should be increamented!");o.x[t]=e[t][0];n=t<e.length-1?(e[t+1][1]-e[t-1][1])/(e[t+1][0]-e[t-1][0]):(e[t][1]-e[t-1][1])/(e[t][0]-e[t-1][0]);o.h[t-1]=y({u:(1-i.t)*.5}).setP(e[t-1][0],e[t-1][1],e[t][0],e[t][1],r,n);r=n}return a};return a}function S(e,t){var r=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e,null):e.currentStyle;return x(t)?r.getPropertyValue(t):r}var A=function e(t){var r=document.getElementsByTagName("head")[0];r.style["color"]=t;var n=S(r,"color");var i=n.replace(/^rgba?\(([^)]+)\)$/,"$1").split(new RegExp("\\,"+g.whitespace));return[+i[0],+i[1],+i[2],i[3]==undefined?1:+i[3]]};var M=function e(t,r){if(!(r&&r>=0&&r<=1))r=1;var n=[];for(var i=1;i<=t;i++){n.push("rgba("+(Math.random(1)*230+20).toFixed(0)+","+(Math.random(1)*230+20).toFixed(0)+","+(Math.random(1)*230+20).toFixed(0)+","+r+")")}return n};function z(e){var f=e||{},l,n;var i=function e(){var a=[],s=0,u=0;(function e(t,r){if(r>u)u=r;var n;for(n=0;n<t.children.length;n++){e(l[t.children[n]],r+1)}l[t.id].left=r+.5;if(n==0){if(a[r]==undefined)a[r]=-.5;if(a[r-1]==undefined)a[r-1]=-.5;l[t.id].top=a[r]+1;var i=a[r]+1+(l[t.pid].children.length-1)*.5;if(i-1<a[r-1])l[t.id].top=a[r-1]+1-(l[t.pid].children.length-1)*.5}else{l[t.id].top=(l[t.children[0]].top+l[t.children[n-1]].top)*.5}if(l[t.id].top<=a[r]){var o=a[r]+1-l[t.id].top;(function e(t,r){l[t].top+=o;if(a[r]<l[t].top)a[r]=l[t].top;var n;for(n=0;n<l[t].children.length;n++){e(l[t].children[n],r+1)}})(t.id,r)}a[r]=l[t.id].top;if(l[t.id].top+.5>s)s=l[t.id].top+.5})(l[n],0);return{node:l,root:n,size:s,deep:u+1}};var o=function e(o){var a={};var t=f.root(o),s,r;s=r=f.id(t);a[s]={data:t,pid:null,id:s,children:[]};var u=1;(function e(t,r){var n=f.child(t,o),i;u+=n?n.length:0;for(i=0;n&&i<n.length;i++){s=f.id(n[i]);a[r].children.push(s);a[s]={data:n[i],pid:r,id:s,children:[]};e(n[i],s)}})(t,s);return{value:[r,a],num:u}};var t=function e(t){var r=o(t);l=r.value[1];n=r.value[0];if(r.num==1){l[n].left=.5;l[n].top=.5;return{deep:1,node:l,root:n,size:1}}return i()};t.root=function(e){f.root=e;return t};t.child=function(e){f.child=e;return t};t.id=function(e){f.id=e;return t};return t}var R=function e(t,r,n,i,o){var a=Math.cos(n),s=Math.sin(n);return[+((i-t)*a-(o-r)*s+t).toFixed(7),+((i-t)*s+(o-r)*a+r).toFixed(7)]};var O=function e(t,r,n,i,o){var a=Math.sqrt(t*t+r*r);return[+(t*n/a+i).toFixed(7),+(r*n/a+o).toFixed(7)]};var k=function e(t,r,n,i,o){return[+(n*(i-t)+t).toFixed(7),+(n*(o-r)+r).toFixed(7)]};var P=function e(o){o=_({d:[1,1],c:[0,0],p:[0,0]},o);var a={rotate:function e(t){var r=o.d[0]+o.p[0],n=o.d[1]+o.p[1];var i=R(o.p[0],o.p[1],t,r,n);o.d=[i[0]-o.p[0],i[1]-o.p[1]];return a},move:function e(t){o.p=O(o.d[0],o.d[1],t,o.p[0],o.p[1]);return a},scale:function e(t){o.p=k(o.c[0],o.c[1],t,o.p[0],o.p[1]);return a},value:function e(){return o.p}};return a};function I(m){m=_({"begin-deg":0,deg:Math.PI*2},m);var y=z().root(m.root).child(m.child).id(m.id);var t=function e(t){var r=y(t);for(var n in r.node){r.node[n].deep=r.node[n].left-.5}if(m.type==="LR"||m.type==="RL"){var i=m.width/r.deep;if("RL"===m.type)i*=-1;var o=m.height/(r.size- -.5);for(var a in r.node){var s=r.node[a];r.node[a].left=+(("RL"==m.type?m.width:0)- -s.left*i).toFixed(7);r.node[a].top=+(s.top*o).toFixed(7)}}else if(m.type==="TB"||m.type==="BT"){var u=m.height/r.deep;if("BT"==m.type)u*=-1;var f=m.width/(r.size- -.5);var l,c;for(var h in r.node){var d=r.node[h];l=d.left;c=d.top;r.node[h].top=+(("BT"==m.type?m.height:0)- -l*u).toFixed(7);r.node[h].left=+(c*f).toFixed(7)}}else if(m.type==="circle"){if(r.deep==1&&r.size==1){r.node[r.root].left=m.cx;r.node[r.root].top=m.cy}else{var p=m.radius/(r.deep-1);var v=m.deg/(r.size- -.5);for(var _ in r.node){var g=r.node[_];r.node[_].deg=(m["begin-deg"]- -v*g.top)%(Math.PI*2);var b=R(m.cx,m.cy,r.node[_].deg,m.cx- -p*(g.left-.5),m.cy);r.node[_].left=+b[0];r.node[_].top=+b[1]}}}if(w(m.drawer)){m.drawer(r);return e}else{return r}};t.config=function(e){m=_(m,e);return t};t.drawer=function(e){m.drawer=e;return t};return t}var E=function e(t,r,n,i){var o=Math.cos(t),a=Math.sin(t);return[r,n*o-i*a,n*a+i*o]},j=function e(t,r,n,i){var o=Math.cos(t),a=Math.sin(t);return[i*a+r*o,n,i*o-r*a]},C=function e(t,r,n,i){var o=Math.cos(t),a=Math.sin(t);return[r*o-n*a,r*a+n*o,i]};var W=[];function D(e,t,r){W=j((360-r)/180*Math.PI,100*e.scale,0,0);W=C(t/180*Math.PI,W[0],W[1],W[2]);W=C((90-e.center[0])/180*Math.PI,W[0],W[1],W[2]);W=E((90-e.center[1])/180*Math.PI,W[0],W[1],W[2]);return[-W[0],W[1],W[2]]}function F(e){var n=_({type:"eoap",scale:1,center:[107,36]},e);var t=function e(t,r){switch(n.type){case"eoap":{return D(n,t,r)}default:{throw new Error("Map type configuration error!")}}};t.config=function(e){n=_(n,e);return t};return t}function B(i){var t=[];var e=function e(n){if(["boolean","number","json","string","color","any"].indexOf(i[n])>-1){t.unshift(function(t){var r=arguments.length>0?false:true;return function(e){return{type:i[n],required:r,animation:e,default:t}}})}else{t.unshift({$animation:v,$cardinal:T,$formatColor:A,$getRandomColors:M,$tree:I,$dot:P,$rotate:R,$move:O,$scale:k,$map:F}[i[n]])}};for(var r=i.length-2;r>=0;r--){e(r)}return i[i.length-1].apply(this,t)}var L=function e(t,r){switch(t){case"boolean":{return r=="true"?true:false}case"number":{if(/deg$/.test(r))return(0- -r.replace(/deg$/,""))/180*Math.PI;if(/pi$/.test(r))return(0- -r.replace(/pi$/,""))*Math.PI;if(x(r))return+r;return r}case"json":{if(x(r)){return JSON.parse(r)}return r}}return r};function U(e,m){e=JSON.parse(JSON.stringify(e));var y=0;return function e(t,r){var n=[];for(var i=0;i<t.length;i++){var o=t[i];if(r||o.name in m){var a={name:o.name,attrs:{},events:[],scope:{},index:y++};var s=r?{attrs:m[r].subAttrs[o.name]}:m[o.name];for(var u in o.attrs){if(/^c\-bind\:/.test(u)||/^\:/.test(u)){o.attrs[u.replace(/^(?:c\-bind){0,1}\:/,"")]={isBind:true,express:o.attrs[u]};delete o.attrs[u]}else if(/^c\-on\:/.test(u)){var f=(u.replace(/^c\-on\:/,"")+"@default").split("@");a.events.push({event:f[0],region:f[1],method:o.attrs[u]})}else if("c-for"==u){var l=/^ {0,}\(/.test(o.attrs[u]);var c=l?/^ {0,}\( {0,}([0-9a-zA-Z_$]+) {0,}, {0,}([0-9a-zA-Z_$]+) {0,}\) {1,}in {1,}([^ ]+) {0,}$/.exec(o.attrs[u]):/^ {0,}([0-9a-zA-Z_$]+) {1,}in {1,}([^ ]+) {0,}$/.exec(o.attrs[u]);a["c-for"]={key:l?c[2]:null,value:c[1],data:l?c[3]:c[2]}}else if("c-if"==u){a["c-if"]=o.attrs[u]}else{o.attrs[u]={isBind:false,express:o.attrs[u]}}}for(var h in o.attrs){if(/^c\-/.test(h));else if(h=="$id"){a.$id=o.attrs.$id}else if(!(h in s.attrs)){console.warn("attrs."+h+" is not defined for "+(r?r+" > "+o.name:o.name)+"!")}}for(var d in s.attrs){var p=s.attrs[d];if(p.required&&!(d in o.attrs)){throw new Error("attrs."+d+" is required for "+(r?r+" > "+o.name:o.name)+"!")}a.attrs[d]={animation:p.animation,type:p.type,value:d in o.attrs?o.attrs[d]:{isBind:false,express:p["default"]}};if(!a.attrs[d].value.isBind){a.attrs[d].value.express=L(a.attrs[d].type,a.attrs[d].value.express)}}var v=[],_=[],g=[];if(o.children){for(var b=0;b<o.children.length;b++){if(x(o.children[b])){g.push(o.children[b])}else if(s.subAttrs&&o.children[b].name in s.subAttrs){_.push(o.children[b])}else{v.push(o.children[b])}}}a.children=e(v);a.subAttrs=e(_,o.name);a.text=g;n.push(a)}else{console.error("Series "+o.name+" is not defined!")}}return n}(e)}var N=function e(t,r,n,i,o){var a=Math.cos(n),s=Math.sin(n);return[+((i-t)*a-(o-r)*s+t).toFixed(7),+((i-t)*s+(o-r)*a+r).toFixed(7)]};function V(e,t,r,n,i,o,a){if(t<0){e+=t;t*=-1}var s=[],u;u=N(0,0,e,i,0);s[0]=u[0];s[1]=u[1];u=N(0,0,t,u[0],u[1]);s[2]=u[0];s[3]=u[1];u=N(0,0,e,o,0);s[4]=u[0];s[5]=u[1];u=N(0,0,t,u[0],u[1]);s[6]=u[0];s[7]=u[1];a(e,e+t,s[0]+r,s[1]+n,s[4]+r,s[5]+n,s[2]+r,s[3]+n,s[6]+r,s[7]+n,(o-i)*.5)}var q=function e(t,r,n,i,o,a){t.beginPath();t.translate(n,i);t.rotate(o);if(a=="uni-app"){t.setFontSize(r["font-size"])}else{t.font=r["font-size"]+"px "+r["font-family"]}return t};var G=function e(c,h,d,p,v,_,t,r){if(v>_){var n=v;v=_;_=n}t=t%(Math.PI*2);if(r>=Math.PI*1.999999||r<=-Math.PI*1.999999){r=Math.PI*2}else{r=r%(Math.PI*2)}V(t,r,d,p,v,_,function(e,t,r,n,i,o,a,s,u,f,l){if(l<0)l=-l;c.beginPath();c.moveTo(r,n);c.arc(d,p,v,e,t,false);if(h["arc-end-cap"]!="round")c.lineTo(u,f);else c.arc((a+u)*.5,(s+f)*.5,l,t-Math.PI,t,true);c.arc(d,p,_,t,e,true);if(h["arc-start-cap"]!="round")c.lineTo(r,n);else c.arc((r+i)*.5,(n+o)*.5,l,e,e-Math.PI,true)});if(h["arc-start-cap"]=="butt")c.closePath();return c};var Z=function e(t,r,n,i){t.beginPath();t.moveTo(r+i,n);t.arc(r,n,i,0,Math.PI*2);return t};var H=function e(t,r,n,i,o){t.beginPath();t.rect(r,n,i,o);return t};var J=function e(t,r,n,i,o){var a=t.createLinearGradient(r,n,i,o);var s={value:function e(){return a},addColorStop:function e(t,r){a.addColorStop(t,r);return s}};return s};var Y=function e(t,r,n,i){var o=t.createRadialGradient(r,n,0,r,n,i);var a={value:function e(){return o},addColorStop:function e(t,r){o.addColorStop(t,r);return a}};return a};function X(o,t,l,c){var h;if(o=="uni-app"){h=t.painter;h.setTextBaseline("middle");h.setTextAlign("left")}else{h=t.getContext("2d");if(l==0||c==0)throw new Error("Canvas is hidden or size is zero!");t.style.width=l+"px";t.style.height=c+"px";t.setAttribute("width",l*2);t.setAttribute("height",c*2);h.scale(2,2);h.textBaseline="middle";h.textAlign="left"}var s={"font-size":"16","font-family":"sans-serif","arc-start-cap":"butt","arc-end-cap":"butt"};var r=o=="uni-app"?function(e,t){if(s[e]){s[e]=t}else{h["set"+e[0].toUpperCase()+e.substr(1)](t)}}:function(e,t){if(e=="lineDash"){h.setLineDash(t)}else if(s[e]){s[e]=t}else{h[e]=t}};var d={config:function e(){if(arguments.length===1){if(n(arguments[0])!=="object")return h[arguments[0]];for(var t in arguments[0]){r(t,arguments[0][t])}}else if(arguments.length===2){r(arguments[0],arguments[1])}return d},fillText:function e(t,r,n,i){h.save();q(h,s,r,n,i||0,o).fillText(t,0,0);h.restore();return d},strokeText:function e(t,r,n,i){h.save();q(h,s,r,n,i||0,o).strokeText(t,0,0);h.restore();return d},fullText:function e(t,r,n,i){h.save();q(h,s,r,n,i||0,o);h.fillText(t,0,0);h.strokeText(t,0,0);h.restore();return d},beginPath:function e(){h.beginPath();return d},closePath:function e(){h.closePath();return d},moveTo:function e(t,r){h.moveTo(t,r);return d},lineTo:function e(t,r){h.lineTo(t,r);return d},arc:function e(t,r,n,i,o){h.arc(t,r,n,i,i+o,o<0);return d},fill:function e(){h.fill();return d},stroke:function e(){h.stroke();return d},full:function e(){h.fill();h.stroke();return d},save:function e(){h.save();return d},restore:function e(){h.restore();return d},quadraticCurveTo:function e(t,r,n,i){h.quadraticCurveTo(t,r,n,i);return d},bezierCurveTo:function e(t,r,n,i,o,a){h.bezierCurveTo(t,r,n,i,o,a);return d},clearRect:function e(t,r,n,i){h.clearRect(t||0,r||0,n||l,i||c);return d},toDataURL:function e(){return t.toDataURL()},drawImage:function e(t,r,n,i,o,a,s,u,f){r=r||0;n=n||0;a=a||0;s=s||0;u=u?u*2:l*2;f=f?f*2:c*2;if(t.nodeName=="CANVAS"){u=u/2;f=f/2;i=i?i*2:l*2;o=o?o*2:c*2}else{i=(i||t.width)*2;o=(o||t.height)*2}h.drawImage(t,r,n,i,o,a,s,u,f);return d},fillArc:function e(t,r,n,i,o,a){G(h,s,t,r,n,i,o,a).fill();return d},strokeArc:function e(t,r,n,i,o,a){G(h,s,t,r,n,i,o,a).stroke();return d},fullArc:function e(t,r,n,i,o,a){G(h,s,t,r,n,i,o,a);h.fill();h.stroke();return d},fillCircle:function e(t,r,n){Z(h,t,r,n).fill();return d},strokeCircle:function e(t,r,n){Z(h,t,r,n).stroke();return d},fullCircle:function e(t,r,n){Z(h,t,r,n);h.fill();h.stroke();return d},fillRect:function e(t,r,n,i){H(h,t,r,n,i).fill();return d},strokeRect:function e(t,r,n,i){H(h,t,r,n,i).stroke();return d},fullRect:function e(t,r,n,i){H(h,t,r,n,i);h.fill();h.stroke();return d},createLinearGradient:function e(t,r,n,i){return J(h,t,r,n,i)},createRadialGradient:function e(t,r,n){return Y(h,t,r,n)}};return d}function K(e,t,r){if(window.attachEvent){e.attachEvent("on"+t,r)}else{e.addEventListener(t,r,false)}}var Q=function e(t,r){var n=t.getBoundingClientRect();return{x:r.clientX-n.left,y:r.clientY-n.top}};function ee(o){var a={},r=[0,0,0],n="r";var s=document.createElement("canvas");var i=X("web",s,1,1);var u=1,f=1;return{erase:function e(){i.config({fillStyle:"rgb(255,255,255)"}).fillRect(0,0,u,f)},updateSize:function e(t,r){u=t;f=r;i=X("web",s,t,r)},painter:function e(t){if(a[t]==undefined)a[t]={r:function e(){r[0]+=1;n="g";return"rgb("+r[0]+","+r[1]+","+r[2]+")"},g:function e(){r[1]+=1;n="b";return"rgb("+r[0]+","+r[1]+","+r[2]+")"},b:function e(){r[2]+=1;n="r";return"rgb("+r[0]+","+r[1]+","+r[2]+")"}}[n]();i.config({fillStyle:a[t],strokeStyle:a[t]});return i},getRegion:function e(t){var r=Q(o.__canvas,t);r.x-=S(o.__canvas,"border-left-width").replace("px","");r.y-=S(o.__canvas,"border-top-width").replace("px","");var n=s.getContext("2d").getImageData(r.x*2-.5,r.y*2-.5,1,1).data;for(var i in a){if("rgb("+n[0]+","+n[1]+","+n[2]+")"==a[i]){return[i,r.x,r.y]}}return[null,r.x,r.y]}}}function te(e){e.prototype.$$init=function(e){this.__options=e;this._platform="platform"in e?e.platform:"web";this.__data=$(e.data)?B(e.data):w(e.data)?e.data():e.data;this.__animation="animation"in e?e.animation:true;this._isMounted=false;this._isDestroyed=false;for(var t in e.methods){b(t);this[t]=$(e.methods[t])?B(e.methods[t]):e.methods[t]}for(var r in this.__data){b(r);this[r]=this.__data[r]}this.__renderFlag=!!e.render||!!e.template;if(!!e.render){this.__renderAOP=U(e.render,this.__defineSerirs)}else if(!!e.template){this.__renderOptions=this.$$templateCompiler(e.template);this.__renderAOP=U(this.__renderOptions,this.__defineSerirs)}this.__observeWatcher={flag:false,stop:null,time:"time"in e?e.time:500};this.__observeResize={help:true,flag:false,observer:null};this.__painter=null;this._width=0;this._height=0;this._min=0;this._max=0;if(this._platform=="web")this.__regionManager=ee(this)}}function re(e){e.prototype.$$lifecycle=function(e){if(w(e)){e()}else{if(["created","beforeMount","mounted","beforeUnmount","unmounted","beforeUpdate","updated","beforeResize","resized","beforeDraw","drawed","beforeDestroy","destroyed"].indexOf(e)>-1&&w(this.__options[e])){this.__options[e].call(this)}}return this}}var ne={blankReg:new RegExp("[\\x20\\t\\r\\n\\f]"),blanksReg:/^[\x20\t\r\n\f]{0,}$/,identifier:/^[a-zA-Z_$][0-9a-zA-Z_$]{0,}$/};var ie=["+","-","*","/","%","&","|","!","?",":","[","]","(",")",">","<","="];var oe=["+","-","*","/","%","&","|","!","?",":",">","<","=","<=",">=","==","===","!=","!=="];function ae(e,r,t){r=r.trim();var n=-1,i=null;var o=function e(){i=n++<r.length-1?r[n]:null;return i};var a=function e(t){return r.substring(n,t+n>r.length?r.length:t+n)};o();var s=[];while(true){if(n>=r.length)break;if(ie.indexOf(i)>-1){if(["&","|","="].indexOf(i)>-1){if(["==="].indexOf(a(3))>-1){s.push(a(3));n+=2;o()}else if(["&&","||","=="].indexOf(a(2))>-1){s.push(a(2));n+=1;o()}else{throw new Error("Illegal expression : "+r+"\nstep='analyseExpress',index="+n)}}else{if(["!=="].indexOf(a(3))>-1){s.push(a(3));n+=2;o()}else if([">=","<=","!="].indexOf(a(2))>-1){s.push(a(2));n+=1;o()}else{s.push(i);o()}}}else if(['"',"'"].indexOf(i)>-1){var u="",f=i;o();while(i!=f){if(n>=r.length){throw new Error("String unclosed error : "+r+"\nstep='analyseExpress',index="+n)}u+=i;o()}s.push(u+"@string");o()}else if(/\d/.test(i)){var l="no";var u=i;o();while(n<r.length){if(/\d/.test(i)){u+=i;if(l=="error")l="yes"}else if("."==i&&l=="no"){u+=i;l="error"}else{break}o()}if(l=="error")u+="0";s.push(+u)}else if(["null","true"].indexOf(a(4))>-1){s.push({null:null,true:true}[a(4)]);n+=3;o()}else if(["false"].indexOf(a(5))>-1){s.push({false:false}[a(5)]);n+=4;o()}else if(["undefined"].indexOf(a(9))>-1){s.push({undefined:undefined}[a(9)]);n+=8;o()}else if(ne.blankReg.test(i)){do{o()}while(ne.blankReg.test(i)&&n<r.length)}else{var c=false;if(i=="."){c=true;o()}if(ne.identifier.test(i)){var h=1;while(n+h<=r.length&&ne.identifier.test(a(h))){h+=1}if(c){s.push("[");s.push(a(h-1)+"@string");s.push("]")}else{var d=a(h-1);var p=d in t?t[d]:e[d];s.push(x(p)?p+"@string":p)}n+=h-2;o()}else{throw new Error("Illegal express : "+r+"\nstep='analyseExpress',index="+n)}}}var v=0;for(var _=0;_<s.length;_++){if(["+","-"].indexOf(s[_])>-1&&(_==0||oe.indexOf(s[v-1])>-1)){s[v++]=+(s[_]+s[_+1]);_+=1}else{s[v++]=s[_]}}s.length=v;return s}var se=function e(t){if(typeof t=="string")return t.replace(/@string$/,"");return t};var ue=function e(t){if(typeof t=="string")return t+"@string";return t};function fe(e){var t=0,r=0;for(;r<e.length;r++){if(e[r]=="!"){e[t]=!e[++r]}else e[t]=e[r];t+=1}if(t==1)return se(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="*"){e[t-1]=se(e[t-1])*se(e[++r])}else if(e[r]=="/"){e[t-1]=se(e[t-1])/se(e[++r])}else if(e[r]=="%"){e[t-1]=se(e[t-1])%se(e[++r])}else{e[t++]=e[r]}}if(t==1)return se(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="+"){e[t-1]=ue(se(e[t-1])+se(e[++r]))}else if(e[r]=="-"){e[t-1]=se(e[t-1])-se(e[++r])}else e[t++]=e[r]}if(t==1)return se(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]==">"){e[t-1]=se(e[t-1])>se(e[++r])}else if(e[r]=="<"){e[t-1]=se(e[t-1])<se(e[++r])}else if(e[r]=="<="){e[t-1]=se(e[t-1])<=se(e[++r])}else if(e[r]==">="){e[t-1]=se(e[t-1])>=se(e[++r])}else e[t++]=e[r]}if(t==1)return se(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="=="){e[t-1]=se(e[t-1])==se(e[++r])}else if(e[r]=="==="){e[t-1]=se(e[t-1])===se(e[++r])}else if(e[r]=="!="){e[t-1]=se(e[t-1])!=se(e[++r])}else if(e[r]=="!=="){e[t-1]=se(e[t-1])!==se(e[++r])}else e[t++]=e[r]}if(t==1)return se(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="&&"){e[t-1]=se(e[t-1])&&se(e[1+r]);r+=1}else if(e[r]=="||"){e[t-1]=se(e[t-1])||se(e[1+r]);r+=1}else e[t++]=e[r]}if(t==1)return se(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="?"){e[t-1]=se(e[t-1])?se(e[r+1]):se(e[r+3]);r+=3}else e[t++]=e[r]}if(t==1)return se(e[0]);e.length=t;throw new Error("Unrecognized expression : ["+e.toString()+"]")}function le(t,r,n){var e=r[0]in n?n[r[0]]:t[r[0]];for(var i=1;i<r.length;i++){try{e=e[r[i]]}catch(e){console.error({target:t,scope:n,expressArray:r,index:i});throw e}}return e}var ce=function e(t,r,n){if(r.indexOf("(")>-1){var i=[],o=[],a=0;for(var s=0;s<r.length;s++){if(r[s]=="("){if(a>0){o.push("(")}a+=1}else if(r[s]==")"){if(a>1)o.push(")");a-=1;if(a==0){var u=fe(e(t,o));i.push(x(u)?u+"@string":u);o=[]}}else{if(a>0)o.push(r[s]);else i.push(r[s])}}r=i}return he(r)};var he=function e(t){var r=true;while(r){r=false;var n=[],i=[],o=false;for(var a=0;a<t.length;a++){if(t[a]=="["&&a!=0&&t[a-1]!="]"){if(o){n.push("[");for(var s=0;s<i.length;s++){n.push(i[s])}}else{o=true}i=[]}else if(t[a]=="]"&&o){r=true;var u=fe(i);var f=n[n.length-1][u];n[n.length-1]=x(f)?f+"@string":f;o=false}else{if(o){i.push(t[a])}else{n.push(t[a])}}}t=n}return t};var de=function e(t){var r=[],n=[];for(var i=0;i<t.length;i++){if(t[i]=="["){n=[]}else if(t[i]=="]"){r.push(fe(n))}else{n.push(t[i])}}return r};function pe(e,t,r){var n=ce(e,t);var i;if(n[0]!="["){i=[fe(n)]}else if(n[n.length-1]=="]"){i=de(n)}else{var o=n.lastIndexOf("]");var a=de(n.slice(0,o+1));var s=n.slice(o+1);s.unshift(le(e,a,r));i=[fe(s)]}return i}var ve=function e(t,r,n){if(arguments.length<3)n={};var i=ae(t,r,n);var o=pe(t,i,n);if(o.length>1)throw new Error("Illegal expression : "+r+"\nstep='evalExpress',path="+o+",expressArray="+i);return o[0]};var _e=function e(t,r,n){if(r.animation&&t.value!=r.value){switch(r.type){case"number":{return{type:r.type,animation:true,value:(r.value-t.value)*n+t.value}}}}return r};function ge(c,h){var d={};for(var e=0;e<c.length;e++){var t={};for(var r=0;r<c[e].subAttr.length;r++){t[c[e].subAttr[r].id]=r}d[c[e].id]={index:e,subLinkIdToIndex:t}}return function(e){if(e==1)return h;var t=[];for(var r=0;r<h.length;r++){if(h[r].id in d){var n=c[d[h[r].id].index];var i={};for(var o in n.attr){i[o]=_e(n.attr[o],h[r].attr[o],e)}var a=[];for(var s=0;s<h[r].subAttr.length;s++){if(h[r].subAttr[s].id in d[h[r].id].subLinkIdToIndex){var u=n.subAttr[d[h[r].id].subLinkIdToIndex[h[r].subAttr[s].id]];var f={};for(var l in u.attr){f[l]=_e(u.attr[l],h[r].subAttr[s].attr[l],e)}a.push({id:u.id,name:u.name,subText:u.subText,subAttr:[],attr:f})}else{a.push(h[r].subAttr[s])}}t.push({id:h[r].id,name:h[r].name,subText:h[r].subText,subAttr:a,attr:i})}}return t}}function be(e){e.prototype.$$updateView=function(){var l=this;if(!this._isMounted||!this.__painter)return;this.$$lifecycle("beforeDraw");if(this._platform=="web")this.__regionManager.erase();this.__painter.clearRect();var e=function e(r){var n={_subTexts:l.__renderSeries[r].subText,_subAttr:[]};for(var t in l.__renderSeries[r].attr){n[t]=l.__renderSeries[r].attr[t].value}for(var i=0;i<l.__renderSeries[r].subAttr.length;i++){var o={series:l.__renderSeries[r].subAttr[i].name,attr:{}};for(var a in l.__renderSeries[r].subAttr[i].attr){o.attr[a]=l.__renderSeries[r].subAttr[i].attr[a].value}n._subAttr.push(o)}l.__defineSerirs[l.__renderSeries[r].name].link(l.__painter,n);if(l._platform=="web"){var s=l.__defineSerirs[l.__renderSeries[r].name].region;if(s){var u=function e(t){s[t](function(e){e=e||"default";return l.__regionManager.painter(r+"@"+t+"::"+e)},n)};for(var f in s){u(f)}}}};for(var t=0;t<this.__renderSeries.length;t++){e(t)}if(this._platform=="uni-app")this.__uniapp_painter.draw();this.$$lifecycle("drawed")};e.prototype.$$updateWithSize=function(){var e=this;this.$$lifecycle("beforeResize");var t=this.__el.clientWidth-(S(this.__el,"padding-left")+"").replace("px","")-(S(this.__el,"padding-right")+"").replace("px","");var r=this.__el.clientHeight-(S(this.__el,"padding-top")+"").replace("px","")-(S(this.__el,"padding-bottom")+"").replace("px","");this.__painter=X(this._platform,this.__canvas,t,r);this._width=t;this._height=r;this._max=t>r?t:r;this._min=t<r?t:r;this.__regionManager.updateSize(t,r);if(w(this.__observeWatcher.stop)){this.__observeWatcher.stop();this.__observeWatcher.stop=null}setTimeout(function(){e.$$updateWithData(true);e.$$lifecycle("resized")},10)};e.prototype.$$updateWithData=function(e){var t=this;if(w(this.__observeWatcher.stop)){this.__observeWatcher.stop();this.__observeWatcher.stop=null}else{this.$$lifecycle("beforeUpdate")}this.__events={click:{},dblclick:{},mousemove:{},mousedown:{},mouseup:{}};var y=[],x=this;(function e(t,r,n,i,o){var a=[];for(var s=0;s<t.length;s++){for(var u in r){if(!(u in t[s].scope)){t[s].scope[u]=r[u]}}var f=void 0;if("$id"in t[s]){f=t[s].$id.isBind?ve(x,t[s].$id.express,t[s].scope):t[s].$id.express}else{f=i+t[s].index}if(!o&&"c-for"in t[s]){var l=t[s]["c-for"];var c=ve(x,l.data,t[s].scope);for(var h in c){t[s].scope[l.value]=c[h];if(l.key!=null)t[s].scope[l.key]=$(c)?+h:h;var d=e([t[s]],{},n,f+"for"+h+"-",true);if(n){for(var p=0;p<d.length;p++){a.push(d[p])}}}continue}if("c-if"in t[s]&&!ve(x,t[s]["c-if"],t[s].scope));else{e(t[s].children,t[s].scope,false,f+"-",false);if(t[s].name!="group"){var v={name:t[s].name,attr:{},subAttr:[],subText:t[s].text,id:f};for(var _ in t[s].attrs){var g=t[s].attrs[_];v.attr[_]={animation:g.animation,type:g.type,value:g.value.isBind?ve(x,g.value.express,t[s].scope):g.value.express}}v.subAttr=e(t[s].subAttrs,t[s].scope,true,f+"-",false);for(var b=0;b<t[s].events.length;b++){var m=t[s].events[b];x.__events[m.event][y.length+"@"+m.region]=x[m.method]}if(n)a.push(v);else y.push(v)}}t[s].scope={}}return a})(this.__renderAOP,{},false,"",false);if(!this.__renderSeries||e||!this.__animation){this.__renderSeries=y;this.$$updateView();this.$$lifecycle("updated");return}var r=ge(this.__renderSeries,y);this.__observeWatcher.stop=v(function(e){t.__renderSeries=r(e);t.$$updateView()},this.__observeWatcher.time,function(e){if(e==1){t.__observeWatcher.stop=null;t.$$lifecycle("updated")}})}}function me(n){var e=function e(t){var r=n.__data[t];n[t]=r;Object.defineProperty(n,t,{get:function e(){return r},set:function e(t){r=t;if(!n.__observeWatcher.flag){window.setTimeout(function(){n.$$updateWithData();n.__observeWatcher.flag=false},0)}n.__observeWatcher.flag=true}})};for(var t in n.__data){e(t)}}function ye(t){if(!(this instanceof ye)){console.error("Clunch is a constructor and should be called with the `new` keyword");return}["beforeCreate","created","beforeMount","mounted","beforeUnmount","unmounted","beforeUpdate","updated","beforeResize","resized","beforeDestroy","destroyed"].forEach(function(e){if($(t[e])){t[e]=B(t[e])}});this.$$lifecycle(t.beforeCreate);this.$$init(t);me(this);this.$$lifecycle("created");this.$mount(t.el)}te(ye);re(ye);be(ye);ye.prototype.__defineSerirs={};function xe(t){try{t.__observeResize.observer=new ResizeObserver(function(){if(!t.__observeResize.flag){t.__observeResize.flag=true;var e=setInterval(function(){if(t.__observeResize.help){window.clearInterval(e);t.__observeResize.flag=false;t.$$updateWithSize()}t.__observeResize.help=true},200)}else{t.__observeResize.help=false}});t.__observeResize.observer.observe(t.__el)}catch(e){t.$$updateWithSize();console.error("ResizeObserver undefined!")}}function we(e){var t=B(e);for(var r in t.attrs){if(w(t.attrs[r])){t.attrs[r]=t.attrs[r](false)}}for(var n in t.subAttrs){for(var i in t.subAttrs[n]){if(w(t.subAttrs[n][i])){t.subAttrs[n][i]=t.subAttrs[n][i](false)}}}return t}function $e(n){n.series=function(e,t){if(arguments.length==1){for(var r in e){n.series(r,e[r])}}else{if(w(n.prototype.__defineSerirs[e])){console.warn("The series["+e+"] has been registered!")}n.prototype.__defineSerirs[e]=we(t)}return n}}$e(ye);ye.prototype.$mount=function(e){var f=this;if(this._isDestroyed){console.warn("The clunch has been destroyed!");return this}if(this._isMounted){console.warn("The clunch is already mounted!");return}if(this._platform=="web"&&!l(e)){console.warn("Mount node does not exist!");return this}this.$$lifecycle("beforeMount");if(!this.__renderFlag){this.__renderOptions=this.$$templateCompiler(e.innerHTML);this.__renderAOP=U(this.__renderOptions,this.__defineSerirs)}this.__el=e;if(this._platform=="web"){e.innerHTML="<canvas>非常抱歉，您的浏览器不支持canvas!</canvas>";this.__canvas=e.getElementsByTagName("canvas")[0];xe(this)}else if(this._platform=="uni-app"){this.__painter=X(this._platform,e,e.width,e.height);this.__uniapp_painter=e.painter;this.$resize(e.width,e.height,"uni-app")}this.$$updateWithData();if(this._platform=="web"){["click","dblclick","mousemove","mousedown","mouseup"].forEach(function(u){K(f.__canvas,u,function(e){var t=f.__regionManager.getRegion(e);if(t[0]!=null){var r=t[0].split("::");var n=f.__events[u][r[0]];if(w(n)){var i=r[0].split("@");var o=f.__renderSeries[i[0]];var a={};for(var s in o.attr){a[s]=o.attr[s].value}n.call(f,{id:o.id,series:o.name,region:i[1],subRegion:r[1],attr:a,left:t[1],top:t[2]})}}})});this.$bind=function(e,u){var f=this;K(this.__canvas,e,function(e){var t=f.__regionManager.getRegion(e);var r;if(t[0]!=null){var n=t[0].split("::");var i=n[0].split("@");var o=f.__renderSeries[i[0]];var a={};for(var s in o.attr){a[s]=o.attr[s].value}r={id:o.id,series:o.name,region:i[1],subRegion:n[1],attr:a}}else{r={series:null,region:null,subRegion:null,attr:{}}}r.left=t[1];r.top=t[2];u.call(f,r)});return this}}this._isMounted=true;this.$$lifecycle("mounted");return this};ye.prototype.$unmount=function(){if(this._isDestroyed){console.warn("The object has been destroyed!");return this}if(!this._isMounted){console.warn("Object not mounted!");return this}this.$$lifecycle("beforeUnmount");this.__observeResize.observer.disconnect();this.__painter=null;this.__canvas=null;this._isMounted=false;this.$$lifecycle("unmounted");return this};ye.prototype.$destroy=function(){if(this._isDestroyed){console.warn("The object has been destroyed!");return this}if(this._isMounted)this.$unmount();this.$$lifecycle("beforeDestroy");delete this.__regionManager;this.__observeResize={};this.__observeWatcher={};this._isDestroyed=true;this.$$lifecycle("destroyed");return this};ye.prototype.$resize=function(e,t,r){if(this._isMounted||arguments.length>=3){if(this._platform=="uni-app"||r=="uni-app"){if(!f(e)){console.warn("The width undefined!");return this}if(!f(t)){console.warn("The height undefined!");return this}this.$$lifecycle("beforeResize");this._width=e;this._height=t;this._max=e>t?e:t;this._min=e<t?e:t;this.$$updateWithData(true);this.$$lifecycle("resized")}else{this.$$updateWithSize()}}else{console.warn("The clunch not mounted!")}return this};ye.series("group",[function(){return{attrs:{}}}]);ye.prototype.$$templateCompiler=function(e){throw new Error("Sorry, setting template property is not supported in the current environment : \n"+e)};if((typeof module==="undefined"?"undefined":n(module))==="object"&&n(module.exports)==="object"){module.exports=ye}else{window.Clunch=ye}})();