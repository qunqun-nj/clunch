/*!
 * clunch.js <core> - üé® The Progressive JavaScript Interactive Picture Framework.
 * git+https://github.com/hai2007/clunch.git
 *
 * author hai2007 < https://hai2007.gitee.io/sweethome >
 *
 * version 0.1.0-alpha.1
 *
 * Copyright (c) 2020 hai2007 Ëµ∞‰∏ÄÊ≠•ÔºåÂÜçËµ∞‰∏ÄÊ≠•„ÄÇ
 * Released under the MIT license
 *
 * Date:Thu Nov 26 2020 15:32:19 GMT+0800 (GMT+08:00)
 */
(function(){"use strict";function r(e){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){r=function(e){return typeof e}}else{r=function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return r(e)}function t(e){if(!(this instanceof t)){console.error("[Clunch error]: Clunch is a constructor and should be called with the `new` keyword");return}}t.prototype.__defineSerirs={};function n(e){var t=r(e);return e!=null&&(t==="object"||t==="function")}var o=Object.prototype.toString;function i(e){if(e==null){return e===undefined?"[object Undefined]":"[object Null]"}return o.call(e)}function e(e){var t=r(e);return t==="string"||t==="object"&&e!=null&&!Array.isArray(e)&&i(e)==="[object String]"}function u(e){if(!n(e)){return false}var t=i(e);return t==="[object Function]"||t==="[object AsyncFunction]"||t==="[object GeneratorFunction]"||t==="[object Proxy]"}var a=e;var x=u;var d=[];var c=13;var l=400;var p=null;function f(t,e,r){var f={timer:function e(t,r,n){if(!t){throw new Error("Tick is required!")}r=r||l;var o=(new Date).valueOf()+"_"+(Math.random()*1e3).toFixed(0);d.push({id:o,createTime:new Date,tick:t,duration:r,callback:n});f.start();return o},start:function e(){if(!p){p=setInterval(f.tick,c)}},tick:function e(){var t,r,e,n,o,i,u,a=d;d=[];d.length=0;for(r=0;r<a.length;r++){o=a[r];t=o.createTime;e=o.tick;i=o.duration;n=o.callback;u=(+new Date-t)/i;u=u>1?1:u;e(u);if(u<1&&o.id){d.push(o)}else if(n){n(u)}}if(d.length<=0){f.stop()}},stop:function e(){if(p){clearInterval(p);p=null}}};var n=f.timer(function(e){t(e)},e,r);return function(){var e;for(e in d){if(d[e].id==n){d[e].id=undefined;return}}}}var s=function e(t,r){for(var n in r){try{t[n]=r[n]}catch(e){throw new Error("Illegal property valueÔºÅ")}}return t};var h={whitespace:"[\\x20\\t\\r\\n\\f]"};function v(e,t){for(var r in t){try{e[r]=t[r]}catch(e){throw new Error("Illegal property valueÔºÅ")}}return e}function y(f){f=v({u:.5},f);var d,c,l;var p=function e(t){if(d){var r=(t-c)/(l-c),n=r*r,o=r*n;var i=o*d[0]+n*d[1]+r*d[2]+d[3];return i*(l-c)}else throw new Error("You shoud first set the position!")};p.setP=function(e,t,r,n,o,i){if(e<r){c=e;l=r;var u=f.u*o,a=f.u*i;t/=r-e;n/=r-e;d=[2*t-2*n+u+a,3*n-3*t-2*u-a,u,t]}else throw new Error("The point x-position should be increamented!");return p};return p}function g(o){o=s({t:0},o);var i,r;var u=function e(t){if(i){r=-1;while(r+1<i.x.length&&(t>i.x[r+1]||r==-1&&t>=i.x[r+1])){r+=1}if(r==-1||r>=i.h.length)throw new Error("Coordinate crossing!");return i.h[r](t)}else{throw new Error("You shoud first set the position!")}};u.setT=function(e){if(typeof e==="number"){o.t=e}else{throw new Error("Expecting a figure!")}return u};u.setP=function(e){i={x:[],h:[]};var t,r=(e[1][1]-e[0][1])/(e[1][0]-e[0][0]),n;i.x[0]=e[0][0];for(t=1;t<e.length;t++){if(e[t][0]<=e[t-1][0])throw new Error("The point position should be increamented!");i.x[t]=e[t][0];n=t<e.length-1?(e[t+1][1]-e[t-1][1])/(e[t+1][0]-e[t-1][0]):(e[t][1]-e[t-1][1])/(e[t][0]-e[t-1][0]);i.h[t-1]=y({u:(1-o.t)*.5}).setP(e[t-1][0],e[t-1][1],e[t][0],e[t][1],r,n);r=n}return u};return u}function m(e,t){var r=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e,null):e.currentStyle;return a(t)?r.getPropertyValue(t):r}var w=function e(t){var r=document.getElementsByTagName("head")[0];r.style["color"]=t;var n=m(r,"color");var o=n.replace(/^rgba?\(([^)]+)\)$/,"$1").split(new RegExp("\\,"+h.whitespace));return[+o[0],+o[1],+o[2],o[3]==undefined?1:+o[3]]};var b=function e(t,r){if(!(r&&r>=0&&r<=1))r=1;var n=[];for(var o=1;o<=t;o++){n.push("rgba("+(Math.random(1)*230+20).toFixed(0)+","+(Math.random(1)*230+20).toFixed(0)+","+(Math.random(1)*230+20).toFixed(0)+","+r+")")}return n};function F(e){var d=e||{},c,n;var o=function e(){var u=[],a=0,f=0;(function e(t,r){if(r>f)f=r;var n;for(n=0;n<t.children.length;n++){e(c[t.children[n]],r+1)}c[t.id].left=r+.5;if(n==0){if(u[r]==undefined)u[r]=-.5;if(u[r-1]==undefined)u[r-1]=-.5;c[t.id].top=u[r]+1;var o=u[r]+1+(c[t.pid].children.length-1)*.5;if(o-1<u[r-1])c[t.id].top=u[r-1]+1-(c[t.pid].children.length-1)*.5}else{c[t.id].top=(c[t.children[0]].top+c[t.children[n-1]].top)*.5}if(c[t.id].top<=u[r]){var i=u[r]+1-c[t.id].top;(function e(t,r){c[t].top+=i;if(u[r]<c[t].top)u[r]=c[t].top;var n;for(n=0;n<c[t].children.length;n++){e(c[t].children[n],r+1)}})(t.id,r)}u[r]=c[t.id].top;if(c[t.id].top+.5>a)a=c[t.id].top+.5})(c[n],0);return{node:c,root:n,size:a,deep:f+1}};var i=function e(i){var u={};var t=d.root(i),a,r;a=r=d.id(t);u[a]={data:t,pid:null,id:a,children:[]};var f=1;(function e(t,r){var n=d.child(t,i),o;f+=n?n.length:0;for(o=0;n&&o<n.length;o++){a=d.id(n[o]);u[r].children.push(a);u[a]={data:n[o],pid:r,id:a,children:[]};e(n[o],a)}})(t,a);return{value:[r,u],num:f}};var t=function e(t){var r=i(t);c=r.value[1];n=r.value[0];if(r.num==1){c[n].left=.5;c[n].top=.5;return{deep:1,node:c,root:n,size:1}}return o()};t.root=function(e){d.root=e;return t};t.child=function(e){d.child=e;return t};t.id=function(e){d.id=e;return t};return t}var $=function e(t,r,n,o,i){var u=Math.cos(n),a=Math.sin(n);return[+((o-t)*u-(i-r)*a+t).toFixed(7),+((o-t)*a+(i-r)*u+r).toFixed(7)]};var S=function e(t,r,n,o,i){var u=Math.sqrt(t*t+r*r);return[+(t*n/u+o).toFixed(7),+(r*n/u+i).toFixed(7)]};var j=function e(t,r,n,o,i){return[+(n*(o-t)+t).toFixed(7),+(n*(i-r)+r).toFixed(7)]};var E=function e(i){i=s({d:[1,1],c:[0,0],p:[0,0]},i);var u={rotate:function e(t){var r=i.d[0]+i.p[0],n=i.d[1]+i.p[1];var o=$(i.p[0],i.p[1],t,r,n);i.d=[o[0]-i.p[0],o[1]-i.p[1]];return u},move:function e(t){i.p=S(i.d[0],i.d[1],t,i.p[0],i.p[1]);return u},scale:function e(t){i.p=j(i.c[0],i.c[1],t,i.p[0],i.p[1]);return u},value:function e(){return i.p}};return u};function T(w){w=s({"begin-deg":0,deg:Math.PI*2},w);var b=F().root(w.root).child(w.child).id(w.id);var t=function e(t){var r=b(t);for(var n in r.node){r.node[n].deep=r.node[n].left-.5}if(w.type==="LR"||w.type==="RL"){var o=w.width/r.deep;if("RL"===w.type)o*=-1;var i=w.height/(r.size- -.5);for(var u in r.node){var a=r.node[u];r.node[u].left=+(("RL"==w.type?w.width:0)- -a.left*o).toFixed(7);r.node[u].top=+(a.top*i).toFixed(7)}}else if(w.type==="TB"||w.type==="BT"){var f=w.height/r.deep;if("BT"==w.type)f*=-1;var d=w.width/(r.size- -.5);var c,l;for(var p in r.node){var s=r.node[p];c=s.left;l=s.top;r.node[p].top=+(("BT"==w.type?w.height:0)- -c*f).toFixed(7);r.node[p].left=+(l*d).toFixed(7)}}else if(w.type==="circle"){if(r.deep==1&&r.size==1){r.node[r.root].left=w.cx;r.node[r.root].top=w.cy}else{var h=w.radius/(r.deep-1);var v=w.deg/(r.size- -.5);for(var y in r.node){var g=r.node[y];r.node[y].deg=(w["begin-deg"]- -v*g.top)%(Math.PI*2);var m=$(w.cx,w.cy,r.node[y].deg,w.cx- -h*(g.left-.5),w.cy);r.node[y].left=+m[0];r.node[y].top=+m[1]}}}if(x(w.drawer)){w.drawer(r);return e}else{return r}};t.config=function(e){w=s(w,e);return t};t.drawer=function(e){w.drawer=e;return t};return t}function C(o){var t=[];var e=function e(n){if(["boolean","number","json","string","color","any"].indexOf(o[n])>-1){t.unshift(function(t){var r=arguments.length>0?false:true;return function(e){return{type:o[n],required:r,animation:e,default:t}}})}else{t.unshift({$animation:f,$cardinal:g,$formatColor:w,$getRandomColors:b,$tree:T,$dot:E,$rotate:$,$move:S,$scale:j}[o[n]])}};for(var r=o.length-2;r>=0;r--){e(r)}return o[o.length-1].apply(this,t)}function M(e){var t=C(e);for(var r in t.attrs){if(x(t.attrs[r])){t.attrs[r]=t.attrs[r](false)}}for(var n in t.subAttrs){for(var o in t.subAttrs[n]){if(x(t.subAttrs[n][o])){t.subAttrs[n][o]=t.subAttrs[n][o](false)}}}return t}function k(n){n.series=function(e,t){if(arguments.length==1){for(var r in e){n.series(r,e[r])}}else{if(x(n.prototype.__defineSerirs[e])){console.warn("The series["+e+"] has been registered!")}n.prototype.__defineSerirs[e]=M(t)}return n}}k(t);t.prototype.$mount=function(e){};t.prototype.$unmount=function(){};t.prototype.$destroy=function(){};t.prototype.$$templateCompiler=function(e){throw new Error("Sorry, setting template property is not supported at this time : \n"+e)};if((typeof module==="undefined"?"undefined":r(module))==="object"&&r(module.exports)==="object"){module.exports=t}else{window.Clunch=t}})();