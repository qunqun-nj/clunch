/*!
 * clunch.js <core> - 🎨 The Progressive JavaScript Interactive Picture Framework.
 * git+https://github.com/hai2007/clunch.git
 *
 * author hai2007 < https://hai2007.gitee.io/sweethome >
 *
 * version 0.1.0-alpha.1
 *
 * Copyright (c) 2020 hai2007 走一步，再走一步。
 * Released under the MIT license
 *
 * Date:Sat Nov 28 2020 17:14:00 GMT+0800 (GMT+08:00)
 */
(function(){"use strict";function n(e){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){n=function(e){return typeof e}}else{n=function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return n(e)}function r(e){var t=n(e);return e!=null&&(t==="object"||t==="function")}var t=Object.prototype.toString;function o(e){if(e==null){return e===undefined?"[object Undefined]":"[object Null]"}return t.call(e)}function e(e){var t=n(e);return t==="string"||t==="object"&&e!=null&&!Array.isArray(e)&&o(e)==="[object String]"}function i(e){if(!r(e)){return false}var t=o(e);return t==="[object Function]"||t==="[object AsyncFunction]"||t==="[object GeneratorFunction]"||t==="[object Proxy]"}function a(e){if(e===null||n(e)!=="object"||o(e)!="[object Object]"){return false}if(Object.getPrototypeOf(e)===null){return true}var t=e;while(Object.getPrototypeOf(t)!==null){t=Object.getPrototypeOf(t)}return Object.getPrototypeOf(e)===t}var s=function e(t,r){return r!==null&&n(r)==="object"&&t.indexOf(r.nodeType)>-1&&!a(r)};var _=e;var w=i;var u=function e(t){return Array.isArray(t)};var f=function e(t){return s([1,9,11],t)};var d=[];var c=13;var l=400;var h=null;function p(t,e,r){var u={timer:function e(t,r,n){if(!t){throw new Error("Tick is required!")}r=r||l;var o=(new Date).valueOf()+"_"+(Math.random()*1e3).toFixed(0);d.push({id:o,createTime:new Date,tick:t,duration:r,callback:n});u.start();return o},start:function e(){if(!h){h=setInterval(u.tick,c)}},tick:function e(){var t,r,e,n,o,i,a,s=d;d=[];d.length=0;for(r=0;r<s.length;r++){o=s[r];t=o.createTime;e=o.tick;i=o.duration;n=o.callback;a=(+new Date-t)/i;a=a>1?1:a;e(a);if(a<1&&o.id){d.push(o)}else if(n){n(a)}}if(d.length<=0){u.stop()}},stop:function e(){if(h){clearInterval(h);h=null}}};var n=u.timer(function(e){t(e)},e,r);return function(){var e;for(e in d){if(d[e].id==n){d[e].id=undefined;return}}}}var v=function e(t,r){for(var n in r){try{t[n]=r[n]}catch(e){throw new Error("Illegal property value！")}}return t};var y={whitespace:"[\\x20\\t\\r\\n\\f]"};var m=function e(t){if(/^[_$]/.test(t)){console.warn("The beginning of _ or $ is not allowed："+t)}};function b(e,t){for(var r in t){try{e[r]=t[r]}catch(e){throw new Error("Illegal property value！")}}return e}function g(u){u=b({u:.5},u);var f,d,c;var l=function e(t){if(f){var r=(t-d)/(c-d),n=r*r,o=r*n;var i=o*f[0]+n*f[1]+r*f[2]+f[3];return i*(c-d)}else throw new Error("You shoud first set the position!")};l.setP=function(e,t,r,n,o,i){if(e<r){d=e;c=r;var a=u.u*o,s=u.u*i;t/=r-e;n/=r-e;f=[2*t-2*n+a+s,3*n-3*t-2*a-s,a,t]}else throw new Error("The point x-position should be increamented!");return l};return l}function $(o){o=v({t:0},o);var i,r;var a=function e(t){if(i){r=-1;while(r+1<i.x.length&&(t>i.x[r+1]||r==-1&&t>=i.x[r+1])){r+=1}if(r==-1||r>=i.h.length)throw new Error("Coordinate crossing!");return i.h[r](t)}else{throw new Error("You shoud first set the position!")}};a.setT=function(e){if(typeof e==="number"){o.t=e}else{throw new Error("Expecting a figure!")}return a};a.setP=function(e){i={x:[],h:[]};var t,r=(e[1][1]-e[0][1])/(e[1][0]-e[0][0]),n;i.x[0]=e[0][0];for(t=1;t<e.length;t++){if(e[t][0]<=e[t-1][0])throw new Error("The point position should be increamented!");i.x[t]=e[t][0];n=t<e.length-1?(e[t+1][1]-e[t-1][1])/(e[t+1][0]-e[t-1][0]):(e[t][1]-e[t-1][1])/(e[t][0]-e[t-1][0]);i.h[t-1]=g({u:(1-o.t)*.5}).setP(e[t-1][0],e[t-1][1],e[t][0],e[t][1],r,n);r=n}return a};return a}function x(e,t){var r=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e,null):e.currentStyle;return _(t)?r.getPropertyValue(t):r}var O=function e(t){var r=document.getElementsByTagName("head")[0];r.style["color"]=t;var n=x(r,"color");var o=n.replace(/^rgba?\(([^)]+)\)$/,"$1").split(new RegExp("\\,"+y.whitespace));return[+o[0],+o[1],+o[2],o[3]==undefined?1:+o[3]]};var j=function e(t,r){if(!(r&&r>=0&&r<=1))r=1;var n=[];for(var o=1;o<=t;o++){n.push("rgba("+(Math.random(1)*230+20).toFixed(0)+","+(Math.random(1)*230+20).toFixed(0)+","+(Math.random(1)*230+20).toFixed(0)+","+r+")")}return n};function A(e){var f=e||{},d,n;var o=function e(){var a=[],s=0,u=0;(function e(t,r){if(r>u)u=r;var n;for(n=0;n<t.children.length;n++){e(d[t.children[n]],r+1)}d[t.id].left=r+.5;if(n==0){if(a[r]==undefined)a[r]=-.5;if(a[r-1]==undefined)a[r-1]=-.5;d[t.id].top=a[r]+1;var o=a[r]+1+(d[t.pid].children.length-1)*.5;if(o-1<a[r-1])d[t.id].top=a[r-1]+1-(d[t.pid].children.length-1)*.5}else{d[t.id].top=(d[t.children[0]].top+d[t.children[n-1]].top)*.5}if(d[t.id].top<=a[r]){var i=a[r]+1-d[t.id].top;(function e(t,r){d[t].top+=i;if(a[r]<d[t].top)a[r]=d[t].top;var n;for(n=0;n<d[t].children.length;n++){e(d[t].children[n],r+1)}})(t.id,r)}a[r]=d[t.id].top;if(d[t.id].top+.5>s)s=d[t.id].top+.5})(d[n],0);return{node:d,root:n,size:s,deep:u+1}};var i=function e(i){var a={};var t=f.root(i),s,r;s=r=f.id(t);a[s]={data:t,pid:null,id:s,children:[]};var u=1;(function e(t,r){var n=f.child(t,i),o;u+=n?n.length:0;for(o=0;n&&o<n.length;o++){s=f.id(n[o]);a[r].children.push(s);a[s]={data:n[o],pid:r,id:s,children:[]};e(n[o],s)}})(t,s);return{value:[r,a],num:u}};var t=function e(t){var r=i(t);d=r.value[1];n=r.value[0];if(r.num==1){d[n].left=.5;d[n].top=.5;return{deep:1,node:d,root:n,size:1}}return o()};t.root=function(e){f.root=e;return t};t.child=function(e){f.child=e;return t};t.id=function(e){f.id=e;return t};return t}var F=function e(t,r,n,o,i){var a=Math.cos(n),s=Math.sin(n);return[+((o-t)*a-(i-r)*s+t).toFixed(7),+((o-t)*s+(i-r)*a+r).toFixed(7)]};var T=function e(t,r,n,o,i){var a=Math.sqrt(t*t+r*r);return[+(t*n/a+o).toFixed(7),+(r*n/a+i).toFixed(7)]};var M=function e(t,r,n,o,i){return[+(n*(o-t)+t).toFixed(7),+(n*(i-r)+r).toFixed(7)]};var S=function e(i){i=v({d:[1,1],c:[0,0],p:[0,0]},i);var a={rotate:function e(t){var r=i.d[0]+i.p[0],n=i.d[1]+i.p[1];var o=F(i.p[0],i.p[1],t,r,n);i.d=[o[0]-i.p[0],o[1]-i.p[1]];return a},move:function e(t){i.p=T(i.d[0],i.d[1],t,i.p[0],i.p[1]);return a},scale:function e(t){i.p=M(i.c[0],i.c[1],t,i.p[0],i.p[1]);return a},value:function e(){return i.p}};return a};function z(_){_=v({"begin-deg":0,deg:Math.PI*2},_);var g=A().root(_.root).child(_.child).id(_.id);var t=function e(t){var r=g(t);for(var n in r.node){r.node[n].deep=r.node[n].left-.5}if(_.type==="LR"||_.type==="RL"){var o=_.width/r.deep;if("RL"===_.type)o*=-1;var i=_.height/(r.size- -.5);for(var a in r.node){var s=r.node[a];r.node[a].left=+(("RL"==_.type?_.width:0)- -s.left*o).toFixed(7);r.node[a].top=+(s.top*i).toFixed(7)}}else if(_.type==="TB"||_.type==="BT"){var u=_.height/r.deep;if("BT"==_.type)u*=-1;var f=_.width/(r.size- -.5);var d,c;for(var l in r.node){var h=r.node[l];d=h.left;c=h.top;r.node[l].top=+(("BT"==_.type?_.height:0)- -d*u).toFixed(7);r.node[l].left=+(c*f).toFixed(7)}}else if(_.type==="circle"){if(r.deep==1&&r.size==1){r.node[r.root].left=_.cx;r.node[r.root].top=_.cy}else{var p=_.radius/(r.deep-1);var v=_.deg/(r.size- -.5);for(var y in r.node){var m=r.node[y];r.node[y].deg=(_["begin-deg"]- -v*m.top)%(Math.PI*2);var b=F(_.cx,_.cy,r.node[y].deg,_.cx- -p*(m.left-.5),_.cy);r.node[y].left=+b[0];r.node[y].top=+b[1]}}}if(w(_.drawer)){_.drawer(r);return e}else{return r}};t.config=function(e){_=v(_,e);return t};t.drawer=function(e){_.drawer=e;return t};return t}function E(o){var t=[];var e=function e(n){if(["boolean","number","json","string","color","any"].indexOf(o[n])>-1){t.unshift(function(t){var r=arguments.length>0?false:true;return function(e){return{type:o[n],required:r,animation:e,default:t}}})}else{t.unshift({$animation:p,$cardinal:$,$formatColor:O,$getRandomColors:j,$tree:z,$dot:S,$rotate:F,$move:T,$scale:M}[o[n]])}};for(var r=o.length-2;r>=0;r--){e(r)}return o[o.length-1].apply(this,t)}function P(e,b){return function e(t,r){var n=[];for(var o=0;o<t.length;o++){var i=t[o];if(r||i.name in b){var a={name:i.name,attrs:{},events:[]};var s=r?{attrs:b[r].subAttrs[i.name]}:b[i.name];for(var u in i.attrs){if(/^c\-bind\:/.test(u)){i.attrs[u.replace(/^c\-bind\:/,"")]={isBind:true,express:i.attrs[u]}}else if(/^c\-on\:/.test(u)){var f=(u.replace(/^c\-on\:/,"")+"@default").split("@");a.events.push({event:f[0],region:f[1],method:i.attrs[u]})}else if("c-for"==u){var d=/^ {0,}\(/.test(i.attrs[u]);var c=d?/^ {0,}\( {0,}([0-9a-zA-Z_$]+) {0,}, {0,}([0-9a-zA-Z_$]+) {0,}\) {1,}in {1,}([^ ]+) {0,}$/.exec(i.attrs[u]):/^ {0,}([0-9a-zA-Z_$]+) {1,}in {1,}([^ ]+) {0,}$/.exec(i.attrs[u]);a["c-for"]={key:d?c[2]:null,value:c[1],data:d?c[3]:c[2]}}else if("c-if"==u){a["c-if"]=i.attrs[u]}else{i.attrs[u]={isBind:false,express:i.attrs[u]}}}for(var l in s.attrs){var h=s.attrs[l];if(h.required&&!(l in i.attrs)){throw new Error("attrs."+l+" is required for series "+i.name+"!")}a.attrs[l]={animation:h.animation,type:h.type,value:l in i.attrs?i.attrs[l]:{isBind:false,express:h["default"]}}}var p=[],v=[],y=[];if(i.children){for(var m=0;m<i.children.length;m++){if(_(i.children[m])){y.push(i.children[m])}else if(s.subAttrs&&i.children[m].name in s.subAttrs){v.push(i.children[m])}else{p.push(i.children[m])}}}a.children=e(p);a.subAttrs=e(v,i.name);a.text=y;n.push(a)}else{console.error("Series "+i.name+" is not defined!")}}return n}(e)}function C(e){e.prototype.$$init=function(e){this.__options=e;this.__data=u(e.data)?E(e.data):w(e.data)?e.data():e.data;this._isMounted=false;this._isDestroyed=false;for(var t in e.methods){m(t);this[t]=u(e.methods[t])?E(e.methods[t]):e.methods[t]}for(var r in this.__data){m(r);this[r]=this.__data[r]}this.__renderFlag=!!e.render||!!e.template;if(!!e.render){this.__renderAOP=P(e.render,this.__defineSerirs)}else if(!!e.template){this.__renderOptions=this.$$templateCompiler(e.template);this.__renderAOP=P(this.__renderOptions,this.__defineSerirs)}}}function R(e){e.prototype.$$lifecycle=function(e){if(w(e)){e()}else{if(["created","beforeMount","mounted","beforeUnmount","unmounted","beforeUpdate","updated","beforeResize","resized","beforeDestroy","destroyed"].indexOf(e)>-1&&w(this.__options[e])){this.__options[e].call(this)}}return this}}function k(n){var e=function e(t){var r=n.__data[t];n[t]=r;Object.defineProperty(n,t,{get:function e(){return r},set:function e(t){r=t;n.$$lifecycle("beforeUpdate");n.$$lifecycle("updated")}})};for(var t in n.__data){e(t)}}function B(t){if(!(this instanceof B)){console.error("Clunch is a constructor and should be called with the `new` keyword");return}["beforeCreate","created","beforeMount","mounted","beforeUnmount","unmounted","beforeUpdate","updated","beforeResize","resized","beforeDestroy","destroyed"].forEach(function(e){if(u(t[e])){t[e]=E(t[e])}});this.$$lifecycle(t.beforeCreate);this.$$init(t);k(this);this.$$lifecycle("created");if(f(t.el)){this.$mount(t.el)}}C(B);R(B);B.prototype.__defineSerirs={};function D(e){try{e.__resizeObserver=new ResizeObserver(function(){console.log("1")});e.__resizeObserver.observe(e.__el)}catch(e){console.info(e);console.error("ResizeObserver undefined!")}}function I(e){var t=E(e);for(var r in t.attrs){if(w(t.attrs[r])){t.attrs[r]=t.attrs[r](false)}}for(var n in t.subAttrs){for(var o in t.subAttrs[n]){if(w(t.subAttrs[n][o])){t.subAttrs[n][o]=t.subAttrs[n][o](false)}}}return t}function L(n){n.series=function(e,t){if(arguments.length==1){for(var r in e){n.series(r,e[r])}}else{if(w(n.prototype.__defineSerirs[e])){console.warn("The series["+e+"] has been registered!")}n.prototype.__defineSerirs[e]=I(t)}return n}}L(B);B.prototype.$mount=function(e){if(this._isDestroyed){console.warn("The clunch has been destroyed!");return}if(this._isMounted){console.warn("The clunch is already mounted!");return}if(!f(e)){console.warn("Mount node does not exist!");return}this.$$lifecycle("beforeMount");if(!this.__renderFlag){this.__renderOptions=this.$$templateCompiler(e.innerHTML);this.__renderAOP=P(this.__renderOptions,this.__defineSerirs)}this.__el=e;e.innerHTML="<canvas>非常抱歉，您的浏览器不支持canvas!</canvas>";this.__canvas=e.getElementsByTagName("canvas")[0];D(this);this._isMounted=true;this.$$lifecycle("mounted");return this};B.prototype.$unmount=function(){};B.prototype.$destroy=function(){};B.series("group",[function(){return{attrs:{}}}]);B.prototype.$$templateCompiler=function(e){throw new Error("Sorry, setting template property is not supported in the current environment : \n"+e)};if((typeof module==="undefined"?"undefined":n(module))==="object"&&n(module.exports)==="object"){module.exports=B}else{window.Clunch=B}})();