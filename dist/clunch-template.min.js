/*!
 * clunch.js <@template> - üé® The Progressive JavaScript Interactive Picture Framework.
 * git+https://github.com/hai2007/clunch.git
 *
 * author hai2007 < https://hai2007.gitee.io/sweethome >
 *
 * version 0.1.0-alpha.1
 *
 * Copyright (c) 2020 hai2007 Ëµ∞‰∏ÄÊ≠•ÔºåÂÜçËµ∞‰∏ÄÊ≠•„ÄÇ
 * Released under the MIT license
 *
 * Date:Wed Nov 25 2020 18:02:02 GMT+0800 (GMT+08:00)
 */
(function(){"use strict";function n(e){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){n=function(e){return typeof e}}else{n=function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return n(e)}function t(e){if(!(this instanceof t)){console.error("[Clunch error]: Clunch is a constructor and should be called with the `new` keyword");return}}t.prototype.$mount=function(e){};t.prototype.$unmount=function(){};t.prototype.$destroy=function(){};var y={blankReg:new RegExp("[\\x20\\t\\r\\n\\f]"),blanksReg:/^[\x20\t\r\n\f]{0,}$/,identifier:/^[a-zA-Z_$][0-9a-zA-Z_$]{0,}$/};var r=Object.prototype.toString;function a(e){if(e==null){return e===undefined?"[object Undefined]":"[object Null]"}return r.call(e)}function e(e){var t=n(e);return t==="string"||t==="object"&&e!=null&&!Array.isArray(e)&&a(e)==="[object String]"}var h=e;function b(l){var o={},i=0;l=l.trim();var e=function e(){var t="",n="";for(;i<l.length;i++){if(y.blanksReg.test(l[i])||i==l.length-1){t+=l[i];if(!y.blanksReg.test(t)){o[t.trim()]=""}i+=1;break}else if(l[i]=="="){i+=1;var r=null,a=-1;if(l.substr(i,1)=='"'||l.substr(i,1)=="'"){r=l.substr(i,1);a=1;i+=1}else if(l.substr(i,2)=='"'||l.substr(i,2)=="'"){r=l.substr(i,2);a=2;i+=2}if(r!==null){for(;i<l.length;i++){if(l.substr(i,a)==r){o[t.trim()]=n.trim();i+=2;break}else{n+=l[i]}}}else{for(;i<l.length;i++){if(y.blanksReg.test(l[i])){o[t.trim()]=n.trim();i+=1;break}else{n+=l[i]}}}break}else{t+=l[i]}}if(i<l.length){e()}};e();return o}function d(u){var f=-1,p=null;var g=false,c="";var m=["script","pre","style","code"];var h=function e(){p=f++<u.length-1?u[f]:null;return p};var d=function e(t){return u.substring(f,t+f>u.length?u.length:t+f)};h();while(y.blankReg.test(p)&&f<u.length-1){h()}return function(){var e=p,t={};if(e==null)return null;if(g){t.type="textcode";t.tagName=e;while(d(c.length+3)!="</"+c+">"&&f<u.length){t.tagName+=h()}t.tagName=t.tagName.replace(/<$/,"");g=false;return t}if(d(4)=="\x3c!--"){t.type="comment";t.tagName=e;while(d(3)!="--\x3e"&&f<u.length){t.tagName+=h()}h();h();h();t.tagName=t.tagName.replace(/^<!--/,"").replace(/-$/,"");return t}if(d(9)=="<!DOCTYPE"){t.type="DOCTYPE";t.tagName=e;while(d(1)!=">"&&f<u.length){t.tagName+=h()}h();t.tagName=t.tagName.replace(/^<!DOCTYPE/,"").replace(/>$/,"");return t}else if(e=="<"){var n=false,r=null,a=null;while(n||p!=">"&&f<u.length){e+=h();if(n){var l=d(a+1).substring(1);if(l==r){n=false}}else{var o=d(2);if(o=='="'||o=="='"){r=o.replace("=","");a=1;n=true}o=d(3);if(o=='="'||o=="='"){r=o.replace("=","");a=2;n=true}}}if(/^<\//.test(e)){t.tagName=e.replace(/^<\//,"").replace(/>$/,"");t.type="endTag"}else{if(/\/>$/.test(e)){t.type="fullTag";e=e.replace(/\/>$/,"")}else{t.type="beginTag";e=e.replace(/>$/,"")}e=e.replace(/^</,"");t.tagName="";var i=0;for(;i<e.length;i++){if(e[i]==" ")break;t.tagName+=e[i]}var s=e.substring(i);if(y.blanksReg.test(s)){t.attrs={}}else{t.attrs=b(s)}}}else{t.type="textcode";t.tagName=p;while(d(1)!="<"&&f<u.length){t.tagName+=h()}t.tagName=t.tagName.replace(/<$/,"");f-=1}if(t.type=="beginTag"){if(m.indexOf(t.tagName.toLowerCase())>-1){g=true;c=t.tagName}}else if(t.type=="endTag"){if(m.indexOf(t.tagName.toLowerCase())>-1){g=false}}h();return t}}function N(e){e=l(e);var t=0,n=[];e.forEach(function(e){if(e.type=="beginTag"){n.push({type:"tag",name:e.tagName,attrs:e.attrs,__deep__:++t,__tagType__:"double"})}else if(e.type=="endTag"){t-=1}else if(e.type=="textcode"){n.push({type:"text",content:e.tagName,__deep__:t+1})}else if(e.type=="comment"){n.push({type:"comment",content:e.tagName,__deep__:t+1})}else{n.push({type:"tag",name:e.tagName,attrs:e.attrs,__deep__:t+1,__tagType__:"single"})}});return n}var l=function e(r){var a=[];r.forEach(function(e,t){if(e.type=="beginTag"){a.push([t,e.tagName])}else if(e.type=="endTag"){while(a.length>0){var n=a.pop();if(n[1]==e.tagName){break}else{r[n[0]].type="fullTag"}}}});return r};function o(e,t){if(!h(e))throw new Error("Template must be a String!");var n=d(e.trim());var r=n(),a=[];while(r!=null){if(r.type=="textcode"&&y.blanksReg.test(r.tagName));else if(r.type=="DOCTYPE");else if(r.type=="comment"){if(t){a.push(r)}}else{a.push(r)}r=n()}a=N(a);var l=[null],o=0;for(var i=0;i<a.length;i++){var s=i,u=a[i].__deep__;a[i].childNodes=[];a[i].preNode=null;a[i].nextNode=null;var f=l[l.length-1];var p=l.length>1?l[l.length-2]:null;if(u==o){a[s].preNode=f;a[f].nextNode=s;a[s].parentNode=p;a[p].childNodes.push(s);l[l.length-1]=s}else if(u>o){a[s].parentNode=f;if(f!=null)a[f].childNodes.push(s);l.push(s)}else{var g=l[l.length-1-(o-u)];var c=l[l.length-2-(o-u)];a[s].preNode=g;if(g!=null)a[g].nextNode=s;a[s].parentNode=c;if(c!=null)a[c].childNodes.push(s);for(var m=0;m<o-u;m++){l.pop()}l[l.length-1]=s}o=u}return a}function i(e){console.log(o(e))}t.prototype.$$templateCompiler=i;if((typeof module==="undefined"?"undefined":n(module))==="object"&&n(module.exports)==="object"){module.exports=t}else{window.Clunch=t}})();