/*!
 * clunch.js - 🎨 The Progressive JavaScript Interactive Picture Framework.
 * git+https://github.com/hai2007/clunch.git
 *
 * author hai2007 < https://hai2007.gitee.io/sweethome >
 *
 * version 0.1.0-alpha.1
 *
 * Copyright (c) 2020 hai2007 走一步，再走一步。
 * Released under the MIT license
 *
 * Date:Thu Nov 26 2020 15:32:19 GMT+0800 (GMT+08:00)
 */
(function(){"use strict";function r(t){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){r=function(t){return typeof t}}else{r=function(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t}}return r(t)}function y(t){return e(t)||n(t)||i(t)||l()}function e(t){if(Array.isArray(t))return o(t)}function n(t){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(t))return Array.from(t)}function i(t,e){if(!t)return;if(typeof t==="string")return o(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor)r=t.constructor.name;if(r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(t,e)}function o(t,e){if(e==null||e>t.length)e=t.length;for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function l(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function a(t){if(!(this instanceof a)){console.error("[Clunch error]: Clunch is a constructor and should be called with the `new` keyword");return}}a.prototype.__defineSerirs={};function u(t){var e=r(t);return t!=null&&(e==="object"||e==="function")}var c=Object.prototype.toString;function s(t){if(t==null){return t===undefined?"[object Undefined]":"[object Null]"}return c.call(t)}function t(t){var e=r(t);return e==="string"||e==="object"&&t!=null&&!Array.isArray(t)&&s(t)==="[object String]"}function f(t){if(!u(t)){return false}var e=s(t);return e==="[object Function]"||e==="[object AsyncFunction]"||e==="[object GeneratorFunction]"||e==="[object Proxy]"}var d=t;var w=f;var h=[];var p=13;var v=400;var g=null;function b(e,t,r){var u={timer:function t(e,r,n){if(!e){throw new Error("Tick is required!")}r=r||v;var i=(new Date).valueOf()+"_"+(Math.random()*1e3).toFixed(0);h.push({id:i,createTime:new Date,tick:e,duration:r,callback:n});u.start();return i},start:function t(){if(!g){g=setInterval(u.tick,p)}},tick:function t(){var e,r,t,n,i,o,l,a=h;h=[];h.length=0;for(r=0;r<a.length;r++){i=a[r];e=i.createTime;t=i.tick;o=i.duration;n=i.callback;l=(+new Date-e)/o;l=l>1?1:l;t(l);if(l<1&&i.id){h.push(i)}else if(n){n(l)}}if(h.length<=0){u.stop()}},stop:function t(){if(g){clearInterval(g);g=null}}};var n=u.timer(function(t){e(t)},t,r);return function(){var t;for(t in h){if(h[t].id==n){h[t].id=undefined;return}}}}var k=function t(e,r){for(var n in r){try{e[n]=r[n]}catch(t){throw new Error("Illegal property value！")}}return e};var m={whitespace:"[\\x20\\t\\r\\n\\f]"};function x(t,e){for(var r in e){try{t[r]=e[r]}catch(t){throw new Error("Illegal property value！")}}return t}function A(u){u=x({u:.5},u);var c,s,f;var d=function t(e){if(c){var r=(e-s)/(f-s),n=r*r,i=r*n;var o=i*c[0]+n*c[1]+r*c[2]+c[3];return o*(f-s)}else throw new Error("You shoud first set the position!")};d.setP=function(t,e,r,n,i,o){if(t<r){s=t;f=r;var l=u.u*i,a=u.u*o;e/=r-t;n/=r-t;c=[2*e-2*n+l+a,3*n-3*e-2*l-a,l,e]}else throw new Error("The point x-position should be increamented!");return d};return d}function S(i){i=k({t:0},i);var o,r;var l=function t(e){if(o){r=-1;while(r+1<o.x.length&&(e>o.x[r+1]||r==-1&&e>=o.x[r+1])){r+=1}if(r==-1||r>=o.h.length)throw new Error("Coordinate crossing!");return o.h[r](e)}else{throw new Error("You shoud first set the position!")}};l.setT=function(t){if(typeof t==="number"){i.t=t}else{throw new Error("Expecting a figure!")}return l};l.setP=function(t){o={x:[],h:[]};var e,r=(t[1][1]-t[0][1])/(t[1][0]-t[0][0]),n;o.x[0]=t[0][0];for(e=1;e<t.length;e++){if(t[e][0]<=t[e-1][0])throw new Error("The point position should be increamented!");o.x[e]=t[e][0];n=e<t.length-1?(t[e+1][1]-t[e-1][1])/(t[e+1][0]-t[e-1][0]):(t[e][1]-t[e-1][1])/(t[e][0]-t[e-1][0]);o.h[e-1]=A({u:(1-i.t)*.5}).setP(t[e-1][0],t[e-1][1],t[e][0],t[e][1],r,n);r=n}return l};return l}function T(t,e){var r=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t,null):t.currentStyle;return d(e)?r.getPropertyValue(e):r}var _=function t(e){var r=document.getElementsByTagName("head")[0];r.style["color"]=e;var n=T(r,"color");var i=n.replace(/^rgba?\(([^)]+)\)$/,"$1").split(new RegExp("\\,"+m.whitespace));return[+i[0],+i[1],+i[2],i[3]==undefined?1:+i[3]]};var j=function t(e,r){if(!(r&&r>=0&&r<=1))r=1;var n=[];for(var i=1;i<=e;i++){n.push("rgba("+(Math.random(1)*230+20).toFixed(0)+","+(Math.random(1)*230+20).toFixed(0)+","+(Math.random(1)*230+20).toFixed(0)+","+r+")")}return n};function E(t){var c=t||{},s,n;var i=function t(){var l=[],a=0,u=0;(function t(e,r){if(r>u)u=r;var n;for(n=0;n<e.children.length;n++){t(s[e.children[n]],r+1)}s[e.id].left=r+.5;if(n==0){if(l[r]==undefined)l[r]=-.5;if(l[r-1]==undefined)l[r-1]=-.5;s[e.id].top=l[r]+1;var i=l[r]+1+(s[e.pid].children.length-1)*.5;if(i-1<l[r-1])s[e.id].top=l[r-1]+1-(s[e.pid].children.length-1)*.5}else{s[e.id].top=(s[e.children[0]].top+s[e.children[n-1]].top)*.5}if(s[e.id].top<=l[r]){var o=l[r]+1-s[e.id].top;(function t(e,r){s[e].top+=o;if(l[r]<s[e].top)l[r]=s[e].top;var n;for(n=0;n<s[e].children.length;n++){t(s[e].children[n],r+1)}})(e.id,r)}l[r]=s[e.id].top;if(s[e.id].top+.5>a)a=s[e.id].top+.5})(s[n],0);return{node:s,root:n,size:a,deep:u+1}};var o=function t(o){var l={};var e=c.root(o),a,r;a=r=c.id(e);l[a]={data:e,pid:null,id:a,children:[]};var u=1;(function t(e,r){var n=c.child(e,o),i;u+=n?n.length:0;for(i=0;n&&i<n.length;i++){a=c.id(n[i]);l[r].children.push(a);l[a]={data:n[i],pid:r,id:a,children:[]};t(n[i],a)}})(e,a);return{value:[r,l],num:u}};var e=function t(e){var r=o(e);s=r.value[1];n=r.value[0];if(r.num==1){s[n].left=.5;s[n].top=.5;return{deep:1,node:s,root:n,size:1}}return i()};e.root=function(t){c.root=t;return e};e.child=function(t){c.child=t;return e};e.id=function(t){c.id=t;return e};return e}var P=function t(e,r,n,i,o){var l=Math.cos(n),a=Math.sin(n);return[+((i-e)*l-(o-r)*a+e).toFixed(7),+((i-e)*a+(o-r)*l+r).toFixed(7)]};var $=function t(e,r,n,i,o){var l=Math.sqrt(e*e+r*r);return[+(e*n/l+i).toFixed(7),+(r*n/l+o).toFixed(7)]};var F=function t(e,r,n,i,o){return[+(n*(i-e)+e).toFixed(7),+(n*(o-r)+r).toFixed(7)]};var M=function t(o){o=k({d:[1,1],c:[0,0],p:[0,0]},o);var l={rotate:function t(e){var r=o.d[0]+o.p[0],n=o.d[1]+o.p[1];var i=P(o.p[0],o.p[1],e,r,n);o.d=[i[0]-o.p[0],i[1]-o.p[1]];return l},move:function t(e){o.p=$(o.d[0],o.d[1],e,o.p[0],o.p[1]);return l},scale:function t(e){o.p=F(o.c[0],o.c[1],e,o.p[0],o.p[1]);return l},value:function t(){return o.p}};return l};function z(m){m=k({"begin-deg":0,deg:Math.PI*2},m);var x=E().root(m.root).child(m.child).id(m.id);var e=function t(e){var r=x(e);for(var n in r.node){r.node[n].deep=r.node[n].left-.5}if(m.type==="LR"||m.type==="RL"){var i=m.width/r.deep;if("RL"===m.type)i*=-1;var o=m.height/(r.size- -.5);for(var l in r.node){var a=r.node[l];r.node[l].left=+(("RL"==m.type?m.width:0)- -a.left*i).toFixed(7);r.node[l].top=+(a.top*o).toFixed(7)}}else if(m.type==="TB"||m.type==="BT"){var u=m.height/r.deep;if("BT"==m.type)u*=-1;var c=m.width/(r.size- -.5);var s,f;for(var d in r.node){var h=r.node[d];s=h.left;f=h.top;r.node[d].top=+(("BT"==m.type?m.height:0)- -s*u).toFixed(7);r.node[d].left=+(f*c).toFixed(7)}}else if(m.type==="circle"){if(r.deep==1&&r.size==1){r.node[r.root].left=m.cx;r.node[r.root].top=m.cy}else{var p=m.radius/(r.deep-1);var y=m.deg/(r.size- -.5);for(var v in r.node){var g=r.node[v];r.node[v].deg=(m["begin-deg"]- -y*g.top)%(Math.PI*2);var b=P(m.cx,m.cy,r.node[v].deg,m.cx- -p*(g.left-.5),m.cy);r.node[v].left=+b[0];r.node[v].top=+b[1]}}}if(w(m.drawer)){m.drawer(r);return t}else{return r}};e.config=function(t){m=k(m,t);return e};e.drawer=function(t){m.drawer=t;return e};return e}function I(i){var e=[];var t=function t(n){if(["boolean","number","json","string","color","any"].indexOf(i[n])>-1){e.unshift(function(e){var r=arguments.length>0?false:true;return function(t){return{type:i[n],required:r,animation:t,default:e}}})}else{e.unshift({$animation:b,$cardinal:S,$formatColor:_,$getRandomColors:j,$tree:z,$dot:M,$rotate:P,$move:$,$scale:F}[i[n]])}};for(var r=i.length-2;r>=0;r--){t(r)}return i[i.length-1].apply(this,e)}function C(t){var e=I(t);for(var r in e.attrs){if(w(e.attrs[r])){e.attrs[r]=e.attrs[r](false)}}for(var n in e.subAttrs){for(var i in e.subAttrs[n]){if(w(e.subAttrs[n][i])){e.subAttrs[n][i]=e.subAttrs[n][i](false)}}}return e}function D(n){n.series=function(t,e){if(arguments.length==1){for(var r in t){n.series(r,t[r])}}else{if(w(n.prototype.__defineSerirs[t])){console.warn("The series["+t+"] has been registered!")}n.prototype.__defineSerirs[t]=C(e)}return n}}D(a);a.prototype.$mount=function(t){};a.prototype.$unmount=function(){};a.prototype.$destroy=function(){};var R=["number","json","string","color",function(t,e,r,n){return{attrs:{"fill-color":n("black"),"stroke-color":n("black"),"line-width":t(1)(true),dash:e([]),type:r("fill"),cx:t()(true),cy:t()(true),radius1:t()(true),radius2:t()(true),begin:t(0)(true),deg:t()(true)},region:{default:function t(e,r){e().config({lineWidth:r["line-width"],lineDash:r.dash})[r.type+"Arc"](r.cx,r.cy,r.radius1,r.radius2,r.begin,r.deg)}},link:function t(e,r){e.config({fillStyle:r["fill-color"],strokeStyle:r["stroke-color"],lineWidth:r["line-width"],lineDash:r.dash});var n=r.type;if(w(e[n+"Arc"])){e[n+"Arc"](r.cx,r.cy,r.radius1,r.radius2,r.begin,r.deg)}else{throw new Error("Type error!"+JSON.stringify({series:"arc",type:n}))}}}}];var B=["number","json","string","color",function(t,e,r,n){return{attrs:{"fill-color":n("black"),"stroke-color":n("black"),"line-width":t(1),dash:e([]),type:r("fill"),cx:t()(true),cy:t()(true),radius:t()(true)},region:{default:function t(e,r){e().config({lineWidth:r["line-width"],lineDash:r.dash})[r.type+"Circle"](r.cx,r.cy,r.radius)}},link:function t(e,r){e.config({fillStyle:r["fill-color"],strokeStyle:r["stroke-color"],lineWidth:r["line-width"],lineDash:r.dash});var n=r.type;if(w(e[n+"Circle"])){e[n+"Circle"](r.cx,r.cy,r.radius)}else{throw new Error("Type error!"+JSON.stringify({series:"circle",type:n}))}}}}];var O=["number","string","boolean","json","color",function(t,e,r,n,i){return{attrs:{"fill-color":i("black"),"stroke-color":i("black"),"line-width":t(1)(true),dash:n([]),type:e("stroke"),close:r(false)},subAttrs:{"move-to":{x:t()(true),y:t()(true)},"line-to":{x:t()(true),y:t()(true)},"bezier-to":{x:t()(true),y:t()(true),cp1x:t()(true),cp1y:t()(true),cp2x:t(null)(true),cp2y:t(null)(true)}},link:function t(e,r){e.config({fillStyle:r["fill-color"],strokeStyle:r["stroke-color"],lineWidth:r["line-width"],lineDash:r.dash});e.beginPath();for(var n=0;n<r._subAttr.length;n++){if(r._subAttr[n].series=="move-to"){e.moveTo(r._subAttr[n].attr.x,r._subAttr[n].attr.y)}else if(r._subAttr[n].series=="line-to"){e.lineTo(r._subAttr[n].attr.x,r._subAttr[n].attr.y)}else if(r._subAttr[n].series=="bezier-to"){if(r._subAttr[n].attr.cp2x==null&&r._subAttr[n].attr.cp2y==null){e.quadraticCurveTo(r._subAttr[n].attr.cp1x,r._subAttr[n].attr.cp1y,r._subAttr[n].attr.x,r._subAttr[n].attr.y)}else{e.bezierCurveTo(r._subAttr[n].attr.cp1x,r._subAttr[n].attr.cp1y,r._subAttr[n].attr.cp2x,r._subAttr[n].attr.cp2y,r._subAttr[n].attr.x,r._subAttr[n].attr.y)}}}if(r.close)e.closePath();var i=r.type;if(w(e[i])){e[i]()}else{throw new Error("Type error!"+JSON.stringify({series:"path",type:i}))}}}}];var W=["number","json","string","color","$rotate",function(t,e,r,n,d){return{attrs:{begin:t(0),deg:t(Math.PI*2),color:n("black"),cx:t(),cy:t(),radius:t(),"mark-direction":r("outer"),"value-position":r("mark"),value:e()},link:function t(e,r){var n=r.value;e.config({lineWidth:1,fillStyle:r.color,strokeStyle:r.color,"font-size":"12",textAlign:"center",textBaseline:"middle",lineDash:[]});e.beginPath().arc(r.cx,r.cy,r.radius,r.begin,r.deg).stroke();var i=r["value-position"]=="mark"?n.length:n.length+1;var o=r.deg/(i-1);for(var l=0;l<i;l++){var a,u;(a=(u=e.beginPath()).moveTo.apply(u,y(d(r.cx,r.cy,r.begin+l*o,r.cx+r.radius,r.cy)))).lineTo.apply(a,y(d(r.cx,r.cy,r.begin+l*o,r.cx+r.radius+5*(r["mark-direction"]=="inner"?-1:1),r.cy))).stroke()}for(var c=0;c<n.length;c++){var s=r.begin+o*(c+(r["value-position"]=="mark"?0:.5));var f=s%(Math.PI*2);e.fillText.apply(e,[n[c]].concat(y(d(r.cx,r.cy,s,r.cx+r.radius+15*(r["mark-direction"]=="inner"?-1:1),r.cy)),[s+(f>0&&f<Math.PI||f>-2*Math.PI&&f<-Math.PI?-Math.PI*.5:Math.PI*.5)]))}}}}];var L=["number","json","string","color",function(t,e,r,n){return{attrs:{"fill-color":n("black"),"stroke-color":n("black"),"line-width":t(1),dash:e([]),type:r("fill"),align:r("left"),baseline:r("top"),x:t()(true),y:t()(true),width:t()(true),height:t()(true)},region:{default:function t(e,r){e().config({lineWidth:r["line-width"],lineDash:r.dash})[r.type+"Rect"](r.x,r.y,r.width,r.height)}},link:function t(e,r){if(r.align=="center")r.x-=r.width*.5;else if(r.align=="right")r.x-=r.width;if(r.baseline=="middle")r.y-=r.height*.5;else if(r.baseline=="bottom")r.y-=r.height;e.config({fillStyle:r["fill-color"],strokeStyle:r["stroke-color"],lineWidth:r["line-width"],lineDash:r.dash});var n=r.type;if(w(e[n+"Rect"])){e[n+"Rect"](r.x,r.y,r.width,r.height)}else{throw new Error("Type error!"+JSON.stringify({series:"rect",type:n}))}}}}];var N=["number","json","string","color","$dot",function(t,e,r,n,p){return{attrs:{x:t(),y:t(),direction:r("LR"),length:t(),"mark-direction":r("right"),"value-position":r("mark"),color:n("black"),value:e()},link:function t(e,r){var n=r.value;e.config({lineWidth:1,fillStyle:r.color,strokeStyle:r.color,"font-size":"12",textAlign:r.direction=="LR"||r.direction=="RL"?"center":r.direction=="BT"&&r["mark-direction"]=="right"||r.direction=="TB"&&r["mark-direction"]=="left"?"left":"right",lineDash:[],textBaseline:"middle"});var i;var o;if(r.direction=="LR"){i={x:r.x+r.length,y:r.y};o=r["mark-direction"]=="right"?[0,1]:[0,-1]}else if(r.direction=="RL"){i={x:r.x-r.length,y:r.y};o=r["mark-direction"]=="right"?[0,-1]:[0,1]}else if(r.direction=="TB"){i={x:r.x,y:r.y+r.length};o=r["mark-direction"]=="right"?[-1,0]:[1,0]}else if(r.direction=="BT"){i={x:r.x,y:r.y-r.length};o=r["mark-direction"]=="right"?[1,0]:[-1,0]}else{throw new Error("Type error!"+JSON.stringify({series:"ruler",type:type}))}e.beginPath().moveTo(r.x,r.y).lineTo(i.x,i.y).stroke();var l=r["value-position"]=="mark"?n.length:n.length+1;var a=r.length/(l-1);var u=p({d:[i.x-r.x,i.y-r.y],p:[r.x,r.y]});for(var c=0;c<l;c++){var s;var f=u.value();(s=e.beginPath()).moveTo.apply(s,y(f)).lineTo(f[0]+o[0]*5,f[1]+o[1]*5).stroke();u.move(a)}u=p({d:[i.x-r.x,i.y-r.y],p:[r.x,r.y]});if(r["value-position"]=="between")u.move(a*.5);for(var d=0;d<n.length;d++){var h=u.value();e.fillText(n[d],h[0]+o[0]*15,h[1]+o[1]*15);u.move(a)}}}}];var J=["number","string","json","color",function(t,e,r,n){return{attrs:{"fill-color":n("black"),"stroke-color":n("black"),"font-size":t(16)(true),"font-family":e("sans-serif"),"line-width":t(1),align:e("left"),baseline:e("middle"),type:e("fill"),content:e(null),x:t()(true),y:t()(true),deg:t(0)(true),dash:r([])},region:{default:function t(e,r){e().config({"font-size":r["font-size"],"font-family":r["font-family"],lineWidth:r["line-width"],textAlign:r["align"],textBaseline:r["baseline"],lineDash:r.dash})[r.type+"Text"]((r.content+"").trim(),r.x,r.y,r.deg)}},link:function t(e,r){if(r.content==null){r.content=r._subTexts.join("\n")}e.config({fillStyle:r["fill-color"],strokeStyle:r["stroke-color"],"font-size":r["font-size"],"font-family":r["font-family"],lineWidth:r["line-width"],textAlign:r["align"],textBaseline:r["baseline"],lineDash:r.dash});var n=r.type;if(w(e[n+"Text"])){e[n+"Text"]((r.content+"").trim(),r.x,r.y,r.deg)}else{throw new Error("Type error!"+JSON.stringify({series:"text",type:n}))}}}}];a.prototype.$$templateCompiler=function(t){throw new Error("Sorry, setting template property is not supported at this time : \n"+t)};a.series({arc:R,circle:B,path:O,"polar-ruler":W,rect:L,ruler:N,text:J});if((typeof module==="undefined"?"undefined":r(module))==="object"&&r(module.exports)==="object"){module.exports=a}else{window.Clunch=a}})();